# StyleVault 数据结构设计

## 概述

本文档基于对StyleVault Vue项目的全面分析，整理出项目所需的数据结构，为后续建立数据库做准备。数据结构设计基于项目中的模拟数据、组件逻辑和功能需求。

## 1. 用户数据结构 (User)

### 描述
存储用户基本信息和偏好设置。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 用户唯一标识符 |
| username | VARCHAR(50) | NOT NULL, UNIQUE | 用户名 |
| email | VARCHAR(100) | NOT NULL, UNIQUE | 电子邮箱 |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希值 |
| avatar_url | VARCHAR(255) | NULL | 头像URL |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### SQL示例
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## 2. 衣物类别数据结构 (Category)

### 描述
存储衣物类别信息，如上装、下装、外套等。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 类别唯一标识符 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 类别名称 |
| icon | VARCHAR(50) | NOT NULL | 类别图标名称 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### SQL示例
```sql
CREATE TABLE categories (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE,
    icon VARCHAR(50) NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## 3. 衣物数据结构 (ClothingItem)

### 描述
存储用户拥有的衣物详细信息。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 衣物唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 所属用户ID |
| category_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES categories(id) | 类别ID |
| name | VARCHAR(100) | NOT NULL | 衣物名称 |
| color | VARCHAR(7) | NOT NULL | 颜色代码（十六进制） |
| image_url | VARCHAR(255) | NULL | 图片URL |
| brand | VARCHAR(100) | NULL | 品牌 |
| material | VARCHAR(100) | NULL | 材质 |
| size | VARCHAR(20) | NULL | 衣物尺码 |
| condition | VARCHAR(20) | CHECK (condition IN ('全新', '良好', '一般', '较差')) | 衣物状况 |
| purchase_date | DATE | NULL | 购买日期 |
| last_worn | DATE | NULL | 最后穿着日期 |
| wear_count | INTEGER | NOT NULL, DEFAULT 0 | 穿着次数 |
| view_count | INTEGER | NOT NULL, DEFAULT 0 | 查看次数 |
| last_viewed | DATE | NULL | 最后查看时间 |
| favorite | BOOLEAN | NOT NULL, DEFAULT FALSE | 是否收藏 |
| notes | TEXT | NULL | 用户备注 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### SQL示例
```sql
CREATE TABLE clothing_items (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    category_id INTEGER NOT NULL,
    name VARCHAR(100) NOT NULL,
    color VARCHAR(7) NOT NULL,
    image_url VARCHAR(255),
    brand VARCHAR(100),
    material VARCHAR(100),
    size VARCHAR(20),
    condition VARCHAR(20) CHECK (condition IN ('全新', '良好', '一般', '较差')),
    purchase_date DATE,
    last_worn DATE,
    wear_count INTEGER NOT NULL DEFAULT 0,
    view_count INTEGER NOT NULL DEFAULT 0,
    last_viewed DATE,
    favorite BOOLEAN NOT NULL DEFAULT FALSE,
    notes TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
);
```

## 4. 季节数据结构 (Season)

### 描述
存储季节信息，用于标记衣物适合的季节。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 季节唯一标识符 |
| name | VARCHAR(20) | NOT NULL, UNIQUE | 季节名称 |

### SQL示例
```sql
CREATE TABLE seasons (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(20) NOT NULL UNIQUE
);
```

## 5. 衣物季节关联表 (ClothingItemSeason)

### 描述
存储衣物与季节的多对多关系。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| clothing_item_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES clothing_items(id), PRIMARY KEY | 衣物ID |
| season_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES seasons(id), PRIMARY KEY | 季节ID |

### SQL示例
```sql
CREATE TABLE clothing_item_seasons (
    clothing_item_id INTEGER NOT NULL,
    season_id INTEGER NOT NULL,
    PRIMARY KEY (clothing_item_id, season_id),
    FOREIGN KEY (clothing_item_id) REFERENCES clothing_items(id),
    FOREIGN KEY (season_id) REFERENCES seasons(id)
);
```

## 6. 风格数据结构 (Style)

### 描述
存储衣物风格信息，如休闲、商务、运动等。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 风格唯一标识符 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 风格名称 |

### SQL示例
```sql
CREATE TABLE styles (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE
);
```

## 7. 衣物风格关联表 (ClothingItemStyle)

### 描述
存储衣物与风格的多对多关系。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| clothing_item_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES clothing_items(id), PRIMARY KEY | 衣物ID |
| style_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES styles(id), PRIMARY KEY | 风格ID |

### SQL示例
```sql
CREATE TABLE clothing_item_styles (
    clothing_item_id INTEGER NOT NULL,
    style_id INTEGER NOT NULL,
    PRIMARY KEY (clothing_item_id, style_id),
    FOREIGN KEY (clothing_item_id) REFERENCES clothing_items(id),
    FOREIGN KEY (style_id) REFERENCES styles(id)
);
```

## 8. 标签数据结构 (Tag)

### 描述
存储标签信息，用于标记衣物特征。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 标签唯一标识符 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 标签名称 |

### SQL示例
```sql
CREATE TABLE tags (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE
);
```

## 9. 衣物标签关联表 (ClothingItemTag)

### 描述
存储衣物与标签的多对多关系。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| clothing_item_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES clothing_items(id), PRIMARY KEY | 衣物ID |
| tag_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES tags(id), PRIMARY KEY | 标签ID |

### SQL示例
```sql
CREATE TABLE clothing_item_tags (
    clothing_item_id INTEGER NOT NULL,
    tag_id INTEGER NOT NULL,
    PRIMARY KEY (clothing_item_id, tag_id),
    FOREIGN KEY (clothing_item_id) REFERENCES clothing_items(id),
    FOREIGN KEY (tag_id) REFERENCES tags(id)
);
```

## 10. 场景数据结构 (Scene)

### 描述
存储穿着场景信息，如日常通勤、周末休闲等。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 场景唯一标识符 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 场景名称 |

### SQL示例
```sql
CREATE TABLE scenes (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE
);
```

## 11. 搭配数据结构 (Outfit)

### 描述
存储用户创建的搭配信息。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 搭配唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 所属用户ID |
| name | VARCHAR(100) | NOT NULL | 搭配名称 |
| description | TEXT | NULL | 搭配描述 |
| scene_id | INTEGER | NULL, FOREIGN KEY REFERENCES scenes(id) | 适用场景ID |
| occasion | VARCHAR(50) | NULL | 适用场合（更详细的场景分类） |
| difficulty | VARCHAR(20) | CHECK (difficulty IN ('简单', '中等', '困难')) | 搭配难度 |
| temperature_range | VARCHAR(50) | NULL | 适用温度范围（例如："15-25℃"） |
| image_url | VARCHAR(255) | NULL | 搭配图片URL |
| likes | INTEGER | NOT NULL, DEFAULT 0 | 点赞数 |
| view_count | INTEGER | NOT NULL, DEFAULT 0 | 查看次数 |
| share_count | INTEGER | NOT NULL, DEFAULT 0 | 分享次数 |
| is_public | BOOLEAN | NOT NULL, DEFAULT FALSE | 是否公开 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### SQL示例
```sql
CREATE TABLE outfits (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    scene_id INTEGER,
    occasion VARCHAR(50),
    difficulty VARCHAR(20) CHECK (difficulty IN ('简单', '中等', '困难')),
    temperature_range VARCHAR(50),
    image_url VARCHAR(255),
    likes INTEGER NOT NULL DEFAULT 0,
    view_count INTEGER NOT NULL DEFAULT 0,
    share_count INTEGER NOT NULL DEFAULT 0,
    is_public BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (scene_id) REFERENCES scenes(id)
);
```

## 12. 搭配衣物关联表 (OutfitItem)

### 描述
存储搭配与衣物的多对多关系。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 关联唯一标识符 |
| outfit_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES outfits(id) | 搭配ID |
| clothing_item_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES clothing_items(id) | 衣物ID |
| position | INTEGER | NOT NULL | 在搭配中的位置 |

### SQL示例
```sql
CREATE TABLE outfit_items (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    outfit_id INTEGER NOT NULL,
    clothing_item_id INTEGER NOT NULL,
    position INTEGER NOT NULL,
    FOREIGN KEY (outfit_id) REFERENCES outfits(id),
    FOREIGN KEY (clothing_item_id) REFERENCES clothing_items(id)
);
```

## 13. 用户点赞搭配表 (OutfitLike)

### 描述
存储用户对搭配的点赞记录。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 点赞记录唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| outfit_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES outfits(id) | 搭配ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 点赞时间 |

### SQL示例
```sql
CREATE TABLE outfit_likes (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    outfit_id INTEGER NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (outfit_id) REFERENCES outfits(id),
    UNIQUE (user_id, outfit_id)
);
```

## 14. 用户收藏搭配表 (OutfitFavorite)

### 描述
存储用户收藏的搭配记录。

### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 收藏记录唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| outfit_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES outfits(id) | 搭配ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 收藏时间 |

### SQL示例
```sql
CREATE TABLE outfit_favorites (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    outfit_id INTEGER NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (outfit_id) REFERENCES outfits(id),
    UNIQUE (user_id, outfit_id)
);
```

## 15. 初始数据

### 类别初始数据
```sql
INSERT INTO categories (name, icon) VALUES
('上装', 'tshirt'),
('下装', 'socks'),
('外套', 'vest'),
('鞋履', 'shoe-prints'),
('配饰', 'gem'),
('包包', 'bag-shopping');
```

### 季节初始数据
```sql
INSERT INTO seasons (name) VALUES
('春季'),
('夏季'),
('秋季'),
('冬季');
```

### 风格初始数据
```sql
INSERT INTO styles (name) VALUES
('休闲'),
('运动'),
('商务'),
('摇滚'),
('时尚');
```

### 场景初始数据
```sql
INSERT INTO scenes (name) VALUES
('日常通勤'),
('周末休闲'),
('商务会议'),
('约会聚餐'),
('运动健身'),
('旅行度假'),
('正式场合'),
('家庭聚会');
```

### 标签初始数据
```sql
INSERT INTO tags (name) VALUES
('春季'),
('夏季'),
('秋季'),
('冬季'),
('休闲'),
('运动'),
('商务'),
('正式'),
('摇滚'),
('时尚');
```

### 天气条件初始数据
```sql
INSERT INTO weather_conditions (name, icon) VALUES
('晴天', 'sun'),
('多云', 'cloud'),
('阴天', 'cloud-sun'),
('小雨', 'cloud-rain'),
('大雨', 'cloud-showers-heavy'),
('雪', 'snowflake'),
('雾', 'smog'),
('大风', 'wind');
```

## 16. 索引设计

为了提高查询性能，建议在以下字段上创建索引：

```sql
-- 用户表索引
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);

-- 衣物表索引
CREATE INDEX idx_clothing_items_user_id ON clothing_items(user_id);
CREATE INDEX idx_clothing_items_category_id ON clothing_items(category_id);
CREATE INDEX idx_clothing_items_favorite ON clothing_items(favorite);

-- 搭配表索引
CREATE INDEX idx_outfits_user_id ON outfits(user_id);
CREATE INDEX idx_outfits_scene_id ON outfits(scene_id);
CREATE INDEX idx_outfits_is_public ON outfits(is_public);
CREATE INDEX idx_outfits_likes ON outfits(likes);

-- 搭配衣物关联表索引
CREATE INDEX idx_outfit_items_outfit_id ON outfit_items(outfit_id);
CREATE INDEX idx_outfit_items_clothing_item_id ON outfit_items(clothing_item_id);

-- 用户点赞搭配表索引
CREATE INDEX idx_outfit_likes_user_id ON outfit_likes(user_id);
CREATE INDEX idx_outfit_likes_outfit_id ON outfit_likes(outfit_id);

-- 用户收藏搭配表索引
CREATE INDEX idx_outfit_favorites_user_id ON outfit_favorites(user_id);
CREATE INDEX idx_outfit_favorites_outfit_id ON outfit_favorites(outfit_id);

-- 天气数据表索引
CREATE INDEX idx_weather_data_date ON weather_data(date);
CREATE INDEX idx_weather_data_location ON weather_data(location);
CREATE INDEX idx_weather_data_condition ON weather_data(condition_id);

-- 用户天气偏好表索引
CREATE INDEX idx_user_weather_preferences_user_id ON user_weather_preferences(user_id);

-- 搭配天气条件关联表索引
CREATE INDEX idx_outfit_weather_conditions_outfit_id ON outfit_weather_conditions(outfit_id);
CREATE INDEX idx_outfit_weather_conditions_condition_id ON outfit_weather_conditions(weather_condition_id);

-- 用户花费记录表索引
CREATE INDEX idx_user_expenses_user_id ON user_expenses(user_id);
CREATE INDEX idx_user_expenses_date ON user_expenses(date);
CREATE INDEX idx_user_expenses_category ON user_expenses(category);
```

## 17. 关系图

以下是主要数据表之间的关系：

```
users (用户)
  |
  |-- clothing_items (衣物)
  |     |-- categories (类别)
  |     |-- clothing_item_seasons (衣物季节)
  |     |     |-- seasons (季节)
  |     |-- clothing_item_styles (衣物风格)
  |     |     |-- styles (风格)
  |     |-- clothing_item_tags (衣物标签)
  |           |-- tags (标签)
  |
  |-- outfits (搭配)
  |     |-- scenes (场景)
  |     |-- outfit_items (搭配衣物)
  |     |     |-- clothing_items (衣物)
  |     |-- outfit_likes (搭配点赞)
  |     |     |-- users (用户)
  |     |-- outfit_favorites (搭配收藏)
  |     |     |-- users (用户)
  |     |-- outfit_ratings (搭配评分)
  |     |     |-- users (用户)
  |     |-- outfit_comments (搭配评论)
  |           |-- users (用户)
  |
  |-- user_style_preferences (用户风格偏好)
  |     |-- styles (风格)
  |
  |-- user_outfit_preferences (用户搭配偏好)
  |
  |-- user_weather_preferences (用户天气偏好)
  |
  |-- user_expenses (用户花费记录)
  |
  |-- user_activities (用户活动记录)
  |
  |-- weather_data (天气数据)
  |     |-- weather_conditions (天气条件)
  |
  |-- outfit_weather_conditions (搭配天气条件)
  |     |-- outfits (搭配)
  |     |-- weather_conditions (天气条件)
```

## 18. 天气相关数据结构

### 18.1 天气条件数据结构 (WeatherCondition)

#### 描述
存储天气条件信息，如晴天、雨天、多云等。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 天气条件唯一标识符 |
| name | VARCHAR(50) | NOT NULL, UNIQUE | 天气条件名称 |
| icon | VARCHAR(50) | NULL | 天气条件图标 |

#### SQL示例
```sql
CREATE TABLE weather_conditions (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE,
    icon VARCHAR(50)
);
```

### 18.2 天气数据结构 (WeatherData)

#### 描述
存储历史天气数据，用于分析和推荐搭配。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 天气数据唯一标识符 |
| date | DATE | NOT NULL | 日期 |
| temperature | INTEGER | NOT NULL | 温度（摄氏度） |
| condition_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES weather_conditions(id) | 天气条件ID |
| humidity | INTEGER | NULL | 湿度（百分比） |
| wind_speed | INTEGER | NULL | 风速（公里/小时） |
| location | VARCHAR(100) | NOT NULL | 地点 |

#### SQL示例
```sql
CREATE TABLE weather_data (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    date DATE NOT NULL,
    temperature INTEGER NOT NULL,
    condition_id INTEGER NOT NULL,
    humidity INTEGER,
    wind_speed INTEGER,
    location VARCHAR(100) NOT NULL,
    FOREIGN KEY (condition_id) REFERENCES weather_conditions(id)
);
```

### 18.3 用户天气偏好设置表 (UserWeatherPreference)

#### 描述
存储用户的天气偏好设置，用于个性化搭配推荐。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 偏好设置唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| min_temperature | INTEGER | NULL | 最低偏好温度 |
| max_temperature | INTEGER | NULL | 最高偏好温度 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### SQL示例
```sql
CREATE TABLE user_weather_preferences (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    min_temperature INTEGER,
    max_temperature INTEGER,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 18.4 搭配天气条件关联表 (OutfitWeatherCondition)

#### 描述
存储搭配与天气条件的多对多关系，用于根据天气推荐搭配。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| outfit_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES outfits(id), PRIMARY KEY | 搭配ID |
| weather_condition_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES weather_conditions(id), PRIMARY KEY | 天气条件ID |
| recommendation_score | INTEGER | NOT NULL | 推荐分数（1-100） |

#### SQL示例
```sql
CREATE TABLE outfit_weather_conditions (
    outfit_id INTEGER NOT NULL,
    weather_condition_id INTEGER NOT NULL,
    recommendation_score INTEGER NOT NULL,
    PRIMARY KEY (outfit_id, weather_condition_id),
    FOREIGN KEY (outfit_id) REFERENCES outfits(id),
    FOREIGN KEY (weather_condition_id) REFERENCES weather_conditions(id)
);
```

## 19. 统计分析相关数据结构

### 19.1 用户花费记录表 (UserExpense)

#### 描述
存储用户的衣物购买花费记录，用于统计分析。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 花费记录唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| clothing_item_id | INTEGER | NULL, FOREIGN KEY REFERENCES clothing_items(id) | 关联衣物ID |
| amount | DECIMAL(10, 2) | NOT NULL | 金额 |
| date | DATE | NOT NULL | 花费日期 |
| category | VARCHAR(50) | NOT NULL | 花费类别 |
| description | TEXT | NULL | 描述 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### SQL示例
```sql
CREATE TABLE user_expenses (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    clothing_item_id INTEGER,
    amount DECIMAL(10, 2) NOT NULL,
    date DATE NOT NULL,
    category VARCHAR(50) NOT NULL,
    description TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (clothing_item_id) REFERENCES clothing_items(id)
);
```

## 20. 用户偏好设置数据结构

### 20.1 用户风格偏好表 (UserStylePreference)

#### 描述
存储用户的风格偏好设置，用于个性化搭配推荐。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 偏好设置唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| style_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES styles(id) | 风格ID |
| preference_level | INTEGER | NOT NULL, DEFAULT 5 | 偏好程度（1-10） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### SQL示例
```sql
CREATE TABLE user_style_preferences (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    style_id INTEGER NOT NULL,
    preference_level INTEGER NOT NULL DEFAULT 5,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (style_id) REFERENCES styles(id),
    UNIQUE (user_id, style_id)
);
```

### 20.2 用户搭配偏好表 (UserOutfitPreference)

#### 描述
存储用户的搭配偏好设置，用于个性化搭配推荐。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 偏好设置唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| preference_type | VARCHAR(50) | NOT NULL | 偏好类型（如"颜色"、"场合"、"季节"等） |
| preference_value | VARCHAR(100) | NOT NULL | 偏好值 |
| preference_level | INTEGER | NOT NULL, DEFAULT 5 | 偏好程度（1-10） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### SQL示例
```sql
CREATE TABLE user_outfit_preferences (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    preference_type VARCHAR(50) NOT NULL,
    preference_value VARCHAR(100) NOT NULL,
    preference_level INTEGER NOT NULL DEFAULT 5,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

## 21. 搭配评分和评论数据结构

### 21.1 搭配评分表 (OutfitRating)

#### 描述
存储用户对搭配的评分记录。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 评分记录唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| outfit_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES outfits(id) | 搭配ID |
| rating | INTEGER | NOT NULL, CHECK (rating >= 1 AND rating <= 5) | 评分（1-5星） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 评分时间 |

#### SQL示例
```sql
CREATE TABLE outfit_ratings (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    outfit_id INTEGER NOT NULL,
    rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (outfit_id) REFERENCES outfits(id),
    UNIQUE (user_id, outfit_id)
);
```

### 21.2 搭配评论表 (OutfitComment)

#### 描述
存储用户对搭配的评论记录。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 评论记录唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| outfit_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES outfits(id) | 搭配ID |
| content | TEXT | NOT NULL | 评论内容 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 评论时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### SQL示例
```sql
CREATE TABLE outfit_comments (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    outfit_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (outfit_id) REFERENCES outfits(id)
);
```

## 22. 用户活动记录数据结构

### 22.1 用户活动记录表 (UserActivity)

#### 描述
存储用户的活动记录，用于分析和推荐。

#### 字段定义

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 活动记录唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| activity_type | VARCHAR(50) | NOT NULL | 活动类型（如"查看衣物"、"创建搭配"等） |
| activity_data | TEXT | NULL | 活动相关数据（JSON格式） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 活动时间 |

#### SQL示例
```sql
CREATE TABLE user_activities (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    activity_type VARCHAR(50) NOT NULL,
    activity_data TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

## 23. 数据库设计注意事项

1. **数据一致性**：确保所有外键关系正确，避免 orphaned records（孤立的记录）。
2. **性能优化**：对常用查询字段创建索引，提高查询速度。
3. **安全性**：对敏感数据（如密码）进行加密存储。
4. **扩展性**：设计数据结构时考虑未来功能扩展，预留必要的字段和关系。
5. **备份策略**：制定定期备份策略，防止数据丢失。
6. **数据迁移**：设计数据迁移策略，便于未来数据库结构升级。
7. **数据分区**：对于大型表，考虑使用分区策略提高查询性能。
8. **缓存策略**：设计合理的缓存策略，减少数据库压力。

## 19. API设计建议

基于以上数据结构，建议设计以下API端点：

1. **用户相关**
   - POST /api/users/register - 用户注册
   - POST /api/users/login - 用户登录
   - GET /api/users/profile - 获取用户信息
   - PUT /api/users/profile - 更新用户信息

2. **衣物相关**
   - GET /api/clothing-items - 获取衣物列表
   - POST /api/clothing-items - 添加衣物
   - GET /api/clothing-items/:id - 获取衣物详情
   - PUT /api/clothing-items/:id - 更新衣物信息
   - DELETE /api/clothing-items/:id - 删除衣物
   - PUT /api/clothing-items/:id/favorite - 切换收藏状态

3. **搭配相关**
   - GET /api/outfits - 获取搭配列表
   - POST /api/outfits - 创建搭配
   - GET /api/outfits/:id - 获取搭配详情
   - PUT /api/outfits/:id - 更新搭配
   - DELETE /api/outfits/:id - 删除搭配
   - PUT /api/outfits/:id/like - 点赞搭配
   - PUT /api/outfits/:id/favorite - 收藏搭配

4. **类别相关**
   - GET /api/categories - 获取类别列表

5. **季节相关**
   - GET /api/seasons - 获取季节列表

6. **风格相关**
   - GET /api/styles - 获取风格列表

7. **场景相关**
   - GET /api/scenes - 获取场景列表

8. **标签相关**
   - GET /api/tags - 获取标签列表

## 20. 总结

本文档详细描述了StyleVault项目所需的数据结构，包括用户、衣物、类别、季节、风格、标签、场景和搭配等核心实体，以及它们之间的关系。这些数据结构设计考虑了项目的功能需求、性能优化和未来扩展性，可以作为后续数据库开发的指导文档。
