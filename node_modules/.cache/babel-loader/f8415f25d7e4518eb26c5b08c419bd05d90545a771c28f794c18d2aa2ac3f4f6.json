{"ast":null,"code":"import { ref, onMounted, onUnmounted } from 'vue';\nvar placeholderImage = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y4ZjhmOCIvPgogIDxwYXRoIGQ9Ik0gNTAwIDUwIEwgMTAwIDEwMCBMIDUwIDUwMCBMIDUwMCA5MDAgTCA5MDAgNTAwIEwgOTUwIDEwMCBaIiBzdHJva2U9IiNmMGYwZjAiIHN0cm9rZS13aWR0aD0iMTAiLz4KPC9zdmc+';\n\n// 图片懒加载处理函数\n\nexport default {\n  __name: 'ClothingItem',\n  props: {\n    item: {\n      type: Object,\n      required: true\n    },\n    showInFavoriteMode: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  emits: ['like', 'viewDetail'],\n  setup: function setup(__props, _ref) {\n    var __expose = _ref.expose;\n    __expose();\n\n    // 懒加载相关状态\n    var isLoaded = ref(false);\n    var imageRef = ref(null);\n    var observer = ref(null);\n\n    // 占位图片（一个简单的SVG占位符）\n    var loadImage = function loadImage() {\n      if (imageRef.value && item.image) {\n        var img = new Image();\n        img.src = item.image;\n\n        // 图片加载完成后更新状态\n        img.onload = function () {\n          isLoaded.value = true;\n          // 加载完成后取消观察\n          if (observer.value) {\n            observer.value.unobserve(imageRef.value);\n          }\n        };\n\n        // 加载失败时也标记为已加载，避免一直显示加载动画\n        img.onerror = function () {\n          isLoaded.value = true;\n        };\n      }\n    };\n\n    // 初始化Intersection Observer\n    onMounted(function () {\n      // 检查浏览器是否支持Intersection Observer\n      if ('IntersectionObserver' in window && imageRef.value) {\n        // 创建观察器，当元素进入视口时触发\n        observer.value = new IntersectionObserver(function (entries) {\n          if (entries[0].isIntersecting && !isLoaded.value) {\n            loadImage();\n          }\n        }, {\n          // 设置根边距，提前50px开始加载\n          rootMargin: '50px',\n          threshold: 0.1\n        });\n\n        // 开始观察图片元素\n        observer.value.observe(imageRef.value);\n      } else {\n        // 不支持Intersection Observer的浏览器直接加载图片\n        loadImage();\n      }\n    });\n\n    // 组件卸载时清理观察器\n    onUnmounted(function () {\n      if (observer.value && imageRef.value) {\n        observer.value.unobserve(imageRef.value);\n      }\n    });\n\n    // 季节信息现在统一使用seasons数组，无需格式化\n\n    var __returned__ = {\n      isLoaded: isLoaded,\n      imageRef: imageRef,\n      observer: observer,\n      placeholderImage: placeholderImage,\n      loadImage: loadImage,\n      ref: ref,\n      onMounted: onMounted,\n      onUnmounted: onUnmounted\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","placeholderImage","isLoaded","imageRef","observer","loadImage","value","item","image","img","Image","src","onload","unobserve","onerror","window","IntersectionObserver","entries","isIntersecting","rootMargin","threshold","observe"],"sources":["/Users/sunxiaokai/Desktop/stylevault-vue-project/src/components/common/ui/ClothingItem.vue"],"sourcesContent":["<template>\n<div class=\"group relative\">\n  <div class=\"aspect-square bg-white rounded-xl overflow-hidden shadow-soft hover:shadow-lg transition-all duration-300 mb-3 border-2 border-transparent hover:border-primary/30\" :class=\"{ 'border-primary/50 shadow-lg': item.favorite }\">\n    <!-- 加载状态占位符 -->\n    <div v-if=\"!isLoaded\" class=\"absolute inset-0 bg-gray-100 flex items-center justify-center\">\n      <div class=\"w-8 h-8 border-4 border-gray-200 border-t-primary rounded-full animate-spin\"></div>\n    </div>\n    \n    <img \n      :src=\"isLoaded ? item.image : placeholderImage\"\n      :data-src=\"item.image\"\n      ref=\"imageRef\"\n      :alt=\"item.name\" \n      class=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\n      :class=\"{ 'opacity-0': !isLoaded }\"\n    >\n    \n    <!-- 收藏区域特有的取消收藏按钮 -->\n    <div v-if=\"showInFavoriteMode\" class=\"absolute inset-0 bg-gradient-to-br from-black/70 via-black/50 to-black/70 opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center justify-center rounded-xl backdrop-blur-sm\">\n      <button \n        class=\"px-4 py-2 bg-primary text-white text-sm rounded-full flex items-center space-x-1 hover:bg-primary-dark transition-colors shadow-lg transform scale-95 group-hover:scale-100 transition-transform duration-300\"\n        @click=\"$emit('like', item)\"\n      >\n        <font-awesome-icon :icon=\"['fas', 'heart-broken']\" />\n        <span>取消收藏</span>\n      </button>\n    </div>\n    \n    <!-- 非收藏区域的添加按钮 -->\n    <div v-else class=\"absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center pb-4 rounded-xl\" :class=\"{ 'hidden': item.favorite }\">\n      <button class=\"w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary-dark transition-colors shadow-md transform scale-90 group-hover:scale-100 transition-transform\">\n        <font-awesome-icon :icon=\"['fas', 'plus']\" />\n      </button>\n    </div>\n  </div>\n  <div class=\"px-1\">\n    <h4 class=\"font-medium truncate text-sm\">{{ item.name }}</h4>\n    <p class=\"text-xs text-neutral-500 mt-1\">{{ item.category }} · {{ item.style }}</p>\n    <!-- 季节信息 -->\n    <div class=\"flex flex-wrap gap-1 mt-1\" v-if=\"item.seasons && item.seasons.length > 0\">\n      <span v-for=\"season in item.seasons\" :key=\"season\" class=\"text-xs px-1.5 py-0.5 rounded-full bg-primary/10 text-primary\">\n        {{ season }}\n      </span>\n    </div>\n  </div>\n  \n  <!-- 非收藏区域显示的按钮组 -->\n  <div v-if=\"!showInFavoriteMode\" class=\"absolute top-3 right-3 flex flex-col gap-2 z-10\">\n    <!-- 爱心按钮 -->\n    <button\n      class=\"w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 shadow-md\"\n      :class=\"item.favorite ? 'bg-primary text-white animate-pulse-once' : 'bg-white/90 backdrop-blur text-neutral-400 hover:text-primary hover:bg-white'\"\n      @click=\"$emit('like', item)\"\n    >\n      <font-awesome-icon :icon=\"item.favorite ? ['fas', 'heart'] : ['far', 'heart']\" class=\"text-sm\" />\n    </button>\n    <!-- 详细信息按钮 -->\n    <button\n      class=\"w-8 h-8 rounded-full bg-white/90 backdrop-blur text-neutral-400 hover:text-primary hover:bg-white flex items-center justify-center transition-all duration-300 shadow-md\"\n      @click=\"$emit('viewDetail', item)\"\n    >\n      <font-awesome-icon :icon=\"['fas', 'info']\" class=\"text-sm\" />\n    </button>\n  </div>\n</div>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted } from 'vue'\n\ndefineProps({\n  item: {\n    type: Object,\n    required: true\n  },\n  showInFavoriteMode: {\n    type: Boolean,\n    default: false\n  }\n})\n\ndefineEmits(['like', 'viewDetail'])\n\n// 懒加载相关状态\nconst isLoaded = ref(false)\nconst imageRef = ref(null)\nconst observer = ref(null)\n\n// 占位图片（一个简单的SVG占位符）\nconst placeholderImage = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2Y4ZjhmOCIvPgogIDxwYXRoIGQ9Ik0gNTAwIDUwIEwgMTAwIDEwMCBMIDUwIDUwMCBMIDUwMCA5MDAgTCA5MDAgNTAwIEwgOTUwIDEwMCBaIiBzdHJva2U9IiNmMGYwZjAiIHN0cm9rZS13aWR0aD0iMTAiLz4KPC9zdmc+';\n\n// 图片懒加载处理函数\nconst loadImage = () => {\n  if (imageRef.value && item.image) {\n    const img = new Image();\n    img.src = item.image;\n    \n    // 图片加载完成后更新状态\n    img.onload = () => {\n      isLoaded.value = true;\n      // 加载完成后取消观察\n      if (observer.value) {\n        observer.value.unobserve(imageRef.value);\n      }\n    };\n    \n    // 加载失败时也标记为已加载，避免一直显示加载动画\n    img.onerror = () => {\n      isLoaded.value = true;\n    };\n  }\n};\n\n// 初始化Intersection Observer\nonMounted(() => {\n  // 检查浏览器是否支持Intersection Observer\n  if ('IntersectionObserver' in window && imageRef.value) {\n    // 创建观察器，当元素进入视口时触发\n    observer.value = new IntersectionObserver((entries) => {\n      if (entries[0].isIntersecting && !isLoaded.value) {\n        loadImage();\n      }\n    }, {\n      // 设置根边距，提前50px开始加载\n      rootMargin: '50px',\n      threshold: 0.1\n    });\n    \n    // 开始观察图片元素\n    observer.value.observe(imageRef.value);\n  } else {\n    // 不支持Intersection Observer的浏览器直接加载图片\n    loadImage();\n  }\n});\n\n// 组件卸载时清理观察器\nonUnmounted(() => {\n  if (observer.value && imageRef.value) {\n    observer.value.unobserve(imageRef.value);\n  }\n});\n\n// 季节信息现在统一使用seasons数组，无需格式化\n</script>\n\n<style scoped>\n@keyframes pulse-once {\n  0% {\n    transform: scale(1);\n  }\n  50% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n  }\n}\n\n.animate-pulse-once {\n  animation: pulse-once 0.3s ease-in-out;\n}\n\n/* 图片淡入动画 */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\nimg:not(.opacity-0) {\n  animation: fadeIn 0.5s ease-out;\n}\n\n/* 加载动画 */\n@keyframes spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.animate-spin {\n  animation: spin 1s linear infinite;\n}\n\n/* 性能优化：硬件加速 */\n.aspect-square {\n  transform: translateZ(0);\n  backface-visibility: hidden;\n}\n</style>\n"],"mappings":"AAoEA,SAASA,GAAG,EAAEC,SAAS,EAAEC,WAAW,QAAQ,KAAI;AAqBhD,IAAMC,gBAAgB,GAAG,gVAAgV;;AAEzW;;;;;;;;;;;;;;;;;;;IARA;IACA,IAAMC,QAAQ,GAAGJ,GAAG,CAAC,KAAK;IAC1B,IAAMK,QAAQ,GAAGL,GAAG,CAAC,IAAI;IACzB,IAAMM,QAAQ,GAAGN,GAAG,CAAC,IAAI;;IAEzB;IAIA,IAAMO,SAAS,GAAG,SAAZA,SAASA,CAAA,EAAS;MACtB,IAAIF,QAAQ,CAACG,KAAK,IAAIC,IAAI,CAACC,KAAK,EAAE;QAChC,IAAMC,GAAG,GAAG,IAAIC,KAAK,CAAC,CAAC;QACvBD,GAAG,CAACE,GAAG,GAAGJ,IAAI,CAACC,KAAK;;QAEpB;QACAC,GAAG,CAACG,MAAM,GAAG,YAAM;UACjBV,QAAQ,CAACI,KAAK,GAAG,IAAI;UACrB;UACA,IAAIF,QAAQ,CAACE,KAAK,EAAE;YAClBF,QAAQ,CAACE,KAAK,CAACO,SAAS,CAACV,QAAQ,CAACG,KAAK,CAAC;UAC1C;QACF,CAAC;;QAED;QACAG,GAAG,CAACK,OAAO,GAAG,YAAM;UAClBZ,QAAQ,CAACI,KAAK,GAAG,IAAI;QACvB,CAAC;MACH;IACF,CAAC;;IAED;IACAP,SAAS,CAAC,YAAM;MACd;MACA,IAAI,sBAAsB,IAAIgB,MAAM,IAAIZ,QAAQ,CAACG,KAAK,EAAE;QACtD;QACAF,QAAQ,CAACE,KAAK,GAAG,IAAIU,oBAAoB,CAAC,UAACC,OAAO,EAAK;UACrD,IAAIA,OAAO,CAAC,CAAC,CAAC,CAACC,cAAc,IAAI,CAAChB,QAAQ,CAACI,KAAK,EAAE;YAChDD,SAAS,CAAC,CAAC;UACb;QACF,CAAC,EAAE;UACD;UACAc,UAAU,EAAE,MAAM;UAClBC,SAAS,EAAE;QACb,CAAC,CAAC;;QAEF;QACAhB,QAAQ,CAACE,KAAK,CAACe,OAAO,CAAClB,QAAQ,CAACG,KAAK,CAAC;MACxC,CAAC,MAAM;QACL;QACAD,SAAS,CAAC,CAAC;MACb;IACF,CAAC,CAAC;;IAEF;IACAL,WAAW,CAAC,YAAM;MAChB,IAAII,QAAQ,CAACE,KAAK,IAAIH,QAAQ,CAACG,KAAK,EAAE;QACpCF,QAAQ,CAACE,KAAK,CAACO,SAAS,CAACV,QAAQ,CAACG,KAAK,CAAC;MAC1C;IACF,CAAC,CAAC;;IAEF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}