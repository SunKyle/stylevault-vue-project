# 搭配管理系统 - 共识文档

## 明确的需求描述

构建一个完整的搭配管理系统，允许用户创建、查看、编辑、删除服装搭配，并管理搭配中的衣物。系统需要提供灵活的查询功能，支持按季节、场合、风格等条件筛选搭配。

### 核心功能需求

1. **搭配CRUD操作**
   - 创建新搭配（支持设置名称、描述、季节、场合、风格、封面图片等）
   - 获取搭配列表（支持分页、排序、过滤）
   - 获取单个搭配详情
   - 更新搭配信息
   - 删除搭配（支持软删除）

2. **搭配衣物管理**
   - 添加衣物到搭配
   - 从搭配中移除衣物
   - 重新排序搭配中的衣物
   - 获取搭配中的所有衣物

3. **搭配分类与筛选**
   - 按季节筛选搭配
   - 按场合筛选搭配
   - 按风格筛选搭配
   - 按状态（草稿/已发布/已归档）筛选搭配
   - 按评分筛选搭配

4. **搭配公开/私有设置**
   - 设置搭配为公开或私有
   - 获取用户的公开搭配
   - 获取其他用户的公开搭配（可选）

5. **搭配评分与统计**
   - 为搭配评分（1-5星）
   - 记录搭配使用次数
   - 获取搭配统计信息

## 技术实现方案

### 系统架构

- 采用三层架构：控制器层、服务层、仓库层
- 控制器层处理HTTP请求和响应格式化
- 服务层实现业务逻辑和数据验证
- 仓库层封装数据访问逻辑

### 数据模型

- 使用现有的`Outfit`、`Clothing`和`OutfitClothing`实体模型
- `Outfit`模型包含名称、描述、季节、场合、风格、状态、公开设置等字段
- `OutfitClothing`作为中间表管理搭配和衣物的多对多关系

### API端点设计

#### 搭配管理
- `POST /api/v1/outfits` - 创建新搭配
- `GET /api/v1/outfits` - 获取搭配列表
- `GET /api/v1/outfits/:id` - 获取搭配详情
- `PUT /api/v1/outfits/:id` - 更新搭配信息
- `DELETE /api/v1/outfits/:id` - 删除搭配

#### 搭配衣物管理
- `POST /api/v1/outfits/:id/clothes` - 添加衣物到搭配
- `DELETE /api/v1/outfits/:id/clothes/:clothingId` - 从搭配中移除衣物
- `PUT /api/v1/outfits/:id/clothes/reorder` - 重新排序搭配中的衣物
- `GET /api/v1/outfits/:id/clothes` - 获取搭配中的所有衣物

#### 搭配分类与筛选
- `GET /api/v1/outfits/season/:seasonId` - 按季节筛选搭配
- `GET /api/v1/outfits/occasion/:occasionId` - 按场合筛选搭配
- `GET /api/v1/outfits/style/:styleId` - 按风格筛选搭配
- `GET /api/v1/outfits/status/:status` - 按状态筛选搭配
- `GET /api/v1/outfits/top-rated` - 获取评分最高的搭配

#### 搭配公开/私有设置
- `PUT /api/v1/outfits/:id/public` - 设置搭配为公开
- `PUT /api/v1/outfits/:id/private` - 设置搭配为私有
- `GET /api/v1/outfits/public` - 获取所有公开搭配

#### 搭配评分与统计
- `PUT /api/v1/outfits/:id/rating` - 为搭配评分
- `POST /api/v1/outfits/:id/usage` - 记录搭配使用
- `GET /api/v1/outfits/stats` - 获取搭配统计信息

### 技术约束

- 所有API端点必须使用JWT进行身份验证
- 确保用户只能访问和修改自己的搭配
- 响应格式必须统一为`{ success: boolean, message: string, data?: any, error?: { code: string, details?: string } }`
- 实现适当的错误处理和输入验证
- 支持分页、排序和过滤参数

### 集成方案

- 与现有用户认证系统集成
- 与现有衣物管理系统集成
- 与现有属性系统集成（季节、场合、风格等）
- 可选与天气数据系统集成，提供基于天气的搭配推荐

## 任务边界限制

- **范围限制**：只实现后端API，不包含前端实现
- **用户限制**：主要针对单个用户的搭配管理，不涉及复杂的多用户协作功能
- **数据限制**：假设数据量在合理范围内，不涉及大规模数据处理优化
- **时间限制**：在现有项目架构基础上快速实现核心功能

## 验收标准

1. **功能完整性**：所有核心功能需求都已实现
2. **API符合规范**：API端点设计符合RESTful原则，响应格式统一
3. **安全性**：实现了适当的身份验证和权限控制
4. **错误处理**：提供明确的错误信息和状态码
5. **性能**：基本的查询性能满足需求
6. **代码质量**：遵循项目现有的代码规范和风格
7. **文档完整性**：提供完整的API文档和实现说明