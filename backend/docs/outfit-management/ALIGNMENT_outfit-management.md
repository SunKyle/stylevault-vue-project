# 搭配管理系统 - 对齐文档

## 项目上下文分析

### 现有项目结构

StyleVault项目是一个服装搭配管理系统，采用Vue 3 + TypeScript + Vite构建前端，Node.js + Express构建后端，使用Sequelize ORM与数据库交互。项目采用了典型的分层架构：

- **后端结构**：
  - `controllers/`: 处理HTTP请求，返回响应
  - `services/`: 包含业务逻辑
  - `repositories/`: 数据访问层，与数据库交互
  - `models/`: 实体定义和数据模型
  - `middleware/`: 中间件，如认证、验证等
  - `routes/`: 路由定义
  - `utils/`: 工具函数
  - `config/`: 配置文件

### 核心实体关系

1. **用户(User)**：系统用户，可以管理自己的服装和搭配
2. **衣物(Clothing)**：用户拥有的服装单品
3. **搭配(Outfit)**：由多件衣物组成的搭配方案
4. **搭配-衣物关联(OutfitClothing)**：连接搭配和衣物的中间表
5. **属性(Attribute)**：定义服装和搭配的特性（如季节、场合、风格等）
6. **天气数据(WeatherData)**：提供天气信息，用于推荐合适的搭配

### 现有代码模式

- **仓库模式**：使用Repository模式封装数据访问逻辑
- **服务层**：封装业务逻辑，处理验证和转换
- **控制器**：处理HTTP请求，调用服务层，返回格式化的响应
- **中间件**：处理认证、验证、日志等横切关注点
- **模型定义**：使用Sequelize装饰器定义数据模型和关系
- **错误处理**：统一的错误处理机制，返回标准化的错误响应

### 技术栈

- **后端**：Node.js, Express, TypeScript, Sequelize
- **数据库**：MySQL/PostgreSQL (通过Sequelize支持)
- **身份验证**：JWT (JSON Web Token)
- **API设计**：RESTful API风格

## 任务需求理解

### 原始需求

创建一个完整的搭配管理系统，包括创建、查询、更新、删除搭配，以及搭配与衣物的关联管理。

### 任务边界确认

- **需要实现的功能**：
  1. 搭配的CRUD操作
  2. 搭配与衣物的关联管理
  3. 搭配的分类和筛选
  4. 搭配的公开/私有设置
  5. 搭配的评分和使用统计
- **不需要实现的功能**：
  - 前端界面开发
  - 用户认证和授权（已有基础实现）
  - 推荐算法的完整实现（已有基础架构）

### 需求理解

基于现有项目结构，我需要实现以下组件：

1. **OutfitService**：搭配相关的业务逻辑层
2. **OutfitController**：处理搭配相关的HTTP请求
3. **outfit.ts路由**：定义搭配相关的API端点
4. 确保与现有仓库(OutfitRepository, OutfitClothingRepository)的正确集成
5. 实现符合项目规范的错误处理和响应格式

### 疑问澄清

1. **关于搭配的权限控制**：需要确保用户只能访问和修改自己的搭配，以及授权访问的公开搭配
2. **关于衣物与搭配的关联**：需要实现添加、删除、重新排序衣物到搭配的功能
3. **关于搭配的状态管理**：需要支持草稿、已发布、已归档等状态

## 项目特性规范

### API设计规范

- 遵循RESTful API设计原则
- 统一的响应格式：`{ success: boolean, message: string, data?: any, error?: { code: string, details?: string } }`
- 使用JWT进行身份验证
- 支持分页、排序和过滤

### 代码规范

- 使用TypeScript进行类型定义
- 遵循现有项目的命名规范和代码风格
- 实现适当的错误处理和日志记录
- 确保安全性（如输入验证、权限控制）

### 性能要求

- 支持大量数据的高效查询
- 优化衣物与搭配关联的查询性能
- 合理使用数据库索引