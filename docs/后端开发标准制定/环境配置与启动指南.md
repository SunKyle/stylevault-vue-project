# StyleVault åç«¯ç¯å¢ƒé…ç½®ä¸å¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒæ£€æŸ¥

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

#### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: macOS (ARMæ¶æ„) / Windows / Linux
- **Node.js**: â‰¥18.0.0
- **MySQL**: â‰¥8.0.0
- **Redis**: â‰¥6.0.0 (å¯é€‰ï¼Œç”¨äºç¼“å­˜)

#### å·¥å…·æ£€æŸ¥
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version

# æ£€æŸ¥npmç‰ˆæœ¬
npm --version

# æ£€æŸ¥MySQL
mysql --version

# æ£€æŸ¥Redis (å¯é€‰)
redis-server --version
```

### 2. ç¯å¢ƒé…ç½®

#### 2.1 å…‹éš†é¡¹ç›®
```bash
cd /Users/sunxiaokai/Desktop/stylevault-vue-project
cd backend
```

#### 2.2 å®‰è£…ä¾èµ–
```bash
# ä½¿ç”¨ARMæ¶æ„ä¼˜åŒ–å®‰è£…
npm install --target_arch=arm64

# å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼Œä½¿ç”¨ï¼š
sudo npm install --target_arch=arm64
```

#### 2.3 ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»ºç¯å¢ƒæ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=stylevault_dev
DB_USER=root
DB_PASSWORD=your_password

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRES_IN=7d

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# Redisé…ç½® (å¯é€‰)
REDIS_HOST=localhost
REDIS_PORT=6379

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_MAX_SIZE=5MB
UPLOAD_DIR=uploads/
```

#### 2.4 æ•°æ®åº“è®¾ç½®

##### åˆ›å»ºæ•°æ®åº“
```bash
# ç™»å½•MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE stylevault_dev CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# åˆ›å»ºç”¨æˆ·å¹¶æˆæƒï¼ˆå¯é€‰ï¼‰
CREATE USER 'stylevault'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON stylevault_dev.* TO 'stylevault'@'localhost';
FLUSH PRIVILEGES;
```

##### è¿è¡Œè¿ç§»
```bash
# è¿è¡Œæ‰€æœ‰è¿ç§»
npm run db:migrate

# å¦‚æœæœ‰ç§å­æ•°æ®
npm run db:seed
```

### 3. å¯åŠ¨æœåŠ¡

#### 3.1 å¼€å‘æ¨¡å¼å¯åŠ¨
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æˆ–ä½¿ç”¨ç‰¹å®šç«¯å£
PORT=3001 npm run dev
```

#### 3.2 ç”Ÿäº§æ¨¡å¼å¯åŠ¨
```bash
# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

#### 3.3 ä½¿ç”¨PM2å¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
# å®‰è£…PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start dist/app.js --name stylevault-backend

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# åœæ­¢åº”ç”¨
pm2 stop stylevault-backend

# é‡å¯åº”ç”¨
pm2 restart stylevault-backend
```

### 4. éªŒè¯å®‰è£…

#### 4.1 å¥åº·æ£€æŸ¥
```bash
# æµ‹è¯•API
curl http://localhost:3000/api/v1/health

# åº”è¯¥è¿”å›ï¼š
# {"success":true,"message":"æœåŠ¡è¿è¡Œæ­£å¸¸"}
```

#### 4.2 æ•°æ®åº“è¿æ¥æµ‹è¯•
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
npm run db:test
```

### 5. å¼€å‘å·¥å…·é…ç½®

#### 5.1 VS Codeé…ç½®

åˆ›å»º `.vscode/settings.json`ï¼š
```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "files.exclude": {
    "**/node_modules": true,
    "**/dist": true,
    "**/.git": true
  }
}
```

#### 5.2 è°ƒè¯•é…ç½®

åˆ›å»º `.vscode/launch.json`ï¼š
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug Backend",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/backend/src/app.ts",
      "env": {
        "NODE_ENV": "development"
      },
      "outFiles": ["${workspaceFolder}/backend/dist/**/*.js"],
      "sourceMaps": true,
      "console": "integratedTerminal"
    }
  ]
}
```

### 6. å¸¸è§é—®é¢˜è§£å†³

#### 6.1 ç«¯å£å ç”¨
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3000

# ç»ˆæ­¢è¿›ç¨‹
kill -9 <PID>
```

#### 6.2 MySQLè¿æ¥é”™è¯¯
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
brew services list

# å¯åŠ¨MySQL
brew services start mysql

# é‡ç½®å¯†ç ï¼ˆå¦‚æœéœ€è¦ï¼‰
mysql_secure_installation
```

#### 6.3 æƒé™é—®é¢˜
```bash
# ä¿®å¤npmæƒé™
sudo chown -R $(whoami) ~/.npm

# ä¿®å¤æ–‡ä»¶æƒé™
sudo chown -R $(whoami) /usr/local/lib/node_modules
```

#### 6.4 å†…å­˜ä¸è¶³
```bash
# å¢åŠ Node.jså†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=4096"

# åœ¨package.jsonä¸­æ·»åŠ 
"scripts": {
  "dev": "node --max-old-space-size=4096 -r ts-node/register src/app.ts"
}
```

### 7. æ€§èƒ½ä¼˜åŒ–

#### 7.1 æ•°æ®åº“ä¼˜åŒ–
```bash
# æ·»åŠ æ•°æ®åº“ç´¢å¼•
npm run db:add-index

# ä¼˜åŒ–æŸ¥è¯¢
npm run db:optimize
```

#### 7.2 ç¼“å­˜é…ç½®
```bash
# å¯åŠ¨Redisï¼ˆå¦‚æœä½¿ç”¨ï¼‰
redis-server

# éªŒè¯Redisè¿æ¥
redis-cli ping
```

### 8. ç›‘æ§ä¸æ—¥å¿—

#### 8.1 æ—¥å¿—é…ç½®

åˆ›å»º `src/config/logger.ts`ï¼š
```typescript
import winston from 'winston';

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: 'stylevault-backend' },
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
});

export default logger;
```

#### 8.2 æ€§èƒ½ç›‘æ§
```bash
# å®‰è£…ç›‘æ§å·¥å…·
npm install --save express-status-monitor

# è®¿é—®ç›‘æ§é¢æ¿
http://localhost:3000/status
```

### 9. è‡ªåŠ¨åŒ–è„šæœ¬

#### 9.1 ä¸€é”®å¯åŠ¨è„šæœ¬

åˆ›å»º `scripts/start-dev.sh`ï¼š
```bash
#!/bin/bash

echo "ğŸš€ å¯åŠ¨StyleVaultåç«¯å¼€å‘ç¯å¢ƒ..."

# æ£€æŸ¥ç¯å¢ƒ
if [ ! -f ".env" ]; then
    echo "âŒ .envæ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å¤åˆ¶.env.exampleå¹¶é…ç½®"
    exit 1
fi

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
if ! mysql -h localhost -u root -p -e "USE stylevault_dev" 2>/dev/null; then
    echo "âŒ æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥MySQLæœåŠ¡"
    exit 1
fi

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install --target_arch=arm64

# è¿è¡Œè¿ç§»
echo "ğŸ—„ï¸ è¿è¡Œæ•°æ®åº“è¿ç§»..."
npm run db:migrate

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
echo "ğŸŒŸ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
npm run dev
```

èµ‹äºˆæ‰§è¡Œæƒé™ï¼š
```bash
chmod +x scripts/start-dev.sh
```

#### 9.2 ç”Ÿäº§éƒ¨ç½²è„šæœ¬

åˆ›å»º `scripts/deploy.sh`ï¼š
```bash
#!/bin/bash

echo "ğŸš€ éƒ¨ç½²StyleVaultåç«¯..."

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å®‰è£…ä¾èµ–
npm ci --only=production --target_arch=arm64

# æ„å»ºåº”ç”¨
npm run build

# é‡å¯PM2
pm2 restart stylevault-backend

# å¥åº·æ£€æŸ¥
sleep 5
curl -f http://localhost:3000/api/v1/health || exit 1

echo "âœ… éƒ¨ç½²å®Œæˆ"
```

### 10. ç¯å¢ƒæ£€æŸ¥æ¸…å•

#### å¼€å‘ç¯å¢ƒæ£€æŸ¥
```bash
#!/bin/bash
echo "ğŸ” æ£€æŸ¥å¼€å‘ç¯å¢ƒ..."

# Node.jsç‰ˆæœ¬
node_version=$(node --version)
echo "Node.jsç‰ˆæœ¬: $node_version"

# MySQLè¿æ¥
if mysql -h localhost -u root -p -e "SELECT 1" 2>/dev/null; then
    echo "âœ… MySQLè¿æ¥æ­£å¸¸"
else
    echo "âŒ MySQLè¿æ¥å¤±è´¥"
fi

# Redisè¿æ¥ï¼ˆå¯é€‰ï¼‰
if redis-cli ping 2>/dev/null; then
    echo "âœ… Redisè¿æ¥æ­£å¸¸"
else
    echo "âš ï¸  Redisæœªè¿æ¥ï¼ˆå¯é€‰ï¼‰"
fi

# ç«¯å£æ£€æŸ¥
if lsof -i :3000 2>/dev/null; then
    echo "âš ï¸  ç«¯å£3000å·²è¢«å ç”¨"
else
    echo "âœ… ç«¯å£3000å¯ç”¨"
fi
```

### 11. æ•…éšœæ’é™¤æŒ‡å—

#### 11.1 è¿æ¥é—®é¢˜
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -h localhost -u root -p stylevault_dev -e "SELECT 1"

# æµ‹è¯•Redisè¿æ¥
redis-cli -h localhost -p 6379 ping
```

#### 11.2 æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/combined.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log

# æŸ¥çœ‹PM2æ—¥å¿—
pm2 logs stylevault-backend
```

#### 11.3 æ€§èƒ½é—®é¢˜
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
node --max-old-space-size=4096 src/app.ts

# ä½¿ç”¨clinic.jsè¯Šæ–­
npm install -g clinic
clinic doctor -- node dist/app.js
```

### 12. å¼€å‘å·¥ä½œæµ

#### 12.1 æ—¥å¸¸å¼€å‘æµç¨‹
```bash
# 1. å¯åŠ¨å¼€å‘ç¯å¢ƒ
./scripts/start-dev.sh

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feat/your-feature

# 3. å¼€å‘å¹¶æµ‹è¯•
npm run test:watch

# 4. æäº¤ä»£ç 
git add .
git commit -m "feat: add new feature"

# 5. æ¨é€åˆ°è¿œç¨‹
git push origin feat/your-feature
```

#### 12.2 ä»£ç è´¨é‡æ£€æŸ¥
```bash
# è¿è¡Œä»£ç æ£€æŸ¥
npm run lint

# è‡ªåŠ¨ä¿®å¤
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format

# è¿è¡Œæµ‹è¯•
npm test

# æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡
npm run test:coverage
```

---

## ğŸ¯ å¿«é€ŸéªŒè¯

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œè®¿é—®ä»¥ä¸‹URLéªŒè¯æœåŠ¡ï¼š

1. **å¥åº·æ£€æŸ¥**: http://localhost:3000/api/v1/health
2. **APIæ–‡æ¡£**: http://localhost:3000/api-docs
3. **ç›‘æ§é¢æ¿**: http://localhost:3000/status
4. **æ•°æ®åº“**: æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®è¿ç§»

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹ [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
3. æäº¤Issueåˆ°GitHub
4. è”ç³»å¼€å‘å›¢é˜Ÿ

**è®°ä½**: ç¯å¢ƒé…ç½®æ˜¯å¼€å‘çš„ç¬¬ä¸€æ­¥ï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½æ­£ç¡®å®‰è£…å’Œé…ç½®ã€‚