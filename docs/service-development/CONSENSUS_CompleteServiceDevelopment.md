# 服务层开发共识文档

## 明确的需求描述

完成StyleVault项目中所有仓库对应的服务层实现，确保服务层能够正确处理业务逻辑、数据验证、错误处理，并与现有系统架构保持一致。每个服务应提供完整的CRUD操作，实现用户权限隔离，并遵循统一的代码风格和设计模式。

## 技术实现方案

### 整体架构
- **分层设计**: 遵循现有的控制器层 → 服务层 → 仓库层 → 模型层的分层架构
- **依赖关系**: 服务层依赖于仓库层和模型层，但不依赖于控制器层
- **代码组织**: 每个服务单独放在`src/services/`目录下，文件名遵循`{Entity}Service.ts`命名规范

### 核心功能实现

#### 1. 接口定义
每个服务应定义以下标准接口：
- `{Entity}QueryOptions` - 用于查询参数
- `{Entity}CreateData` - 用于创建数据
- `{Entity}UpdateData` - 用于更新数据

#### 2. 基础CRUD操作
每个服务应实现以下基础操作：
- `create()` - 创建实体
- `getAll()` / `findAll()` - 获取实体列表
- `getById()` / `findById()` - 获取单个实体详情
- `update()` - 更新实体
- `delete()` - 删除实体

#### 3. 用户权限隔离
- 所有涉及用户数据的服务都应验证userId参数
- 确保用户只能访问和操作自己的数据
- 在方法开始处检查userId是否存在

#### 4. 数据验证和转换
- 在服务层实现基本的数据验证（如非空检查、格式验证）
- 执行必要的数据格式转换（如字符串转数字、日期格式化）
- 对输入数据进行清洗（如去除前后空格）

#### 5. 错误处理和日志
- 统一采用try-catch模式捕获异常
- 使用项目提供的logger工具记录详细日志
- 抛出包含详细信息的错误，便于上层处理

### 技术约束和集成方案

- **TypeScript**: 严格遵循TypeScript语法规范，确保类型安全
- **代码风格**: 保持与现有代码风格一致，使用ESLint和Prettier进行代码检查和格式化
- **依赖注入**: 服务层通过导入仓库实例来使用仓库层的功能
- **命名规范**: 遵循现有的命名约定，如camelCase命名变量和方法

## 任务边界限制

- **范围限制**: 仅实现服务层代码，不包括控制器层和仓库层的修改
- **不修改现有代码**: 不改动已有的模型层、仓库层和控制器层代码
- **不引入新技术**: 不引入项目未使用的新库或框架
- **专注核心功能**: 专注于实现服务层的核心业务逻辑，不实现额外的扩展功能

## 验收标准

### 功能完整性
- 所有仓库都有对应的服务层实现
- 每个服务实现完整的CRUD操作
- 每个服务实现基本的业务逻辑和数据验证

### 代码质量
- 通过TypeScript编译检查（`npx tsc --noEmit`）
- 遵循项目现有的代码规范和风格
- 代码简洁、可读，添加适当的注释

### 系统集成
- 服务层正确调用仓库层方法
- 服务层实现用户权限隔离
- 与现有系统架构保持一致

### 错误处理
- 服务层能够正确捕获和处理异常
- 提供详细的错误日志和错误信息
- 错误处理方式与现有服务保持一致

## 关键假设确认

1. **仓库层可靠性**: 假设仓库层的实现是正确的，能够满足服务层的数据访问需求
2. **模型定义准确性**: 假设模型层的定义是准确的，能够正确映射数据库结构
3. **工具可访问性**: 假设logger等工具可以在服务层正常使用
4. **目录结构稳定性**: 假设项目的目录结构在实施期间保持稳定