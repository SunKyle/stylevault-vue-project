# StyleVault 完善版数据库设计方案

## 设计概述

本方案基于已有的"终极单表设计"理念，结合项目实际页面功能和需求，提出一个更加完善、可扩展且高效的数据库设计方案。该方案保留单表设计的优势，同时针对实际应用场景进行了优化。

## 核心设计原则

1. **极简设计**：通过统一属性系统减少表数量，提高查询效率
2. **无限扩展**：支持动态添加新属性类型，无需修改表结构
3. **性能优化**：合理的索引设计和查询策略
4. **数据完整**：保持关系完整性约束
5. **灵活配置**：支持用户个性化偏好设置

## 数据表结构

### 1. 用户表 (users)

存储用户基础信息和偏好设置

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 用户唯一标识符 |
| username | VARCHAR(50) | NOT NULL, UNIQUE | 用户名 |
| email | VARCHAR(100) | NOT NULL, UNIQUE | 电子邮箱 |
| password_hash | VARCHAR(255) | NOT NULL | 密码哈希值 |
| avatar_url | VARCHAR(255) | NULL | 头像URL |
| preferences | JSON | NULL | 用户偏好设置（主题、语言等） |
| style_profile | JSON | NULL | 用户风格画像（基于用户行为生成的风格偏好） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 2. 衣物表 (clothing_items)

存储用户衣物基础信息和扩展属性

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 衣物唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 所属用户ID |
| name | VARCHAR(100) | NOT NULL | 衣物名称 |
| brand | VARCHAR(100) | NULL | 品牌 |
| price | DECIMAL(10,2) | NULL | 价格 |
| purchase_date | DATE | NULL | 购买日期 |
| size | VARCHAR(20) | NULL | 尺码 |
| condition | VARCHAR(20) | CHECK (condition IN ('全新', '良好', '一般', '较差')) | 状况 |
| notes | TEXT | NULL | 备注 |
| image_urls | JSON | NULL | 图片URL数组 |
| main_image_url | VARCHAR(255) | NULL | 主图URL（封面图） |
| category_id | INTEGER | NULL | 主要分类ID（冗余字段，提高查询性能） |
| color_id | INTEGER | NULL | 主要颜色ID（冗余字段，提高查询性能） |
| style_id | INTEGER | NULL | 主要风格ID（冗余字段，提高查询性能） |
| metadata | JSON | NULL | 元数据（统计数据、使用频率等） |
| is_public | BOOLEAN | NOT NULL, DEFAULT FALSE | 是否公开 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 3. 搭配表 (outfits)

存储用户创建的搭配信息和组合关系

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 搭配唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 所属用户ID |
| name | VARCHAR(100) | NOT NULL | 搭配名称 |
| description | TEXT | NULL | 搭配描述 |
| thumbnail_url | VARCHAR(255) | NULL | 缩略图URL |
| composition | JSON | NOT NULL | 搭配组成信息（包含衣物ID和位置关系） |
| styling_tips | TEXT | NULL | 搭配技巧和建议 |
| likes | INTEGER | NOT NULL, DEFAULT 0 | 点赞数 |
| view_count | INTEGER | NOT NULL, DEFAULT 0 | 查看次数 |
| share_count | INTEGER | NOT NULL, DEFAULT 0 | 分享次数 |
| is_public | BOOLEAN | NOT NULL, DEFAULT FALSE | 是否公开 |
| is_featured | BOOLEAN | NOT NULL, DEFAULT FALSE | 是否为精选搭配 |
| metadata | JSON | NULL | 元数据（统计数据、标签等） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 4. 搭配-衣物关联表 (outfit_clothing)

存储搭配与衣物的多对多关系

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 关联唯一标识符 |
| outfit_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES outfits(id) | 搭配ID |
| clothing_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES clothing_items(id) | 衣物ID |
| position | INTEGER | DEFAULT 0 | 在搭配中的位置 |
| area | VARCHAR(20) | NULL | 在搭配中的区域（上装、下装等） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |

### 5. 属性定义表 (attributes)

**统一存储所有属性**（季节、风格、场景、材质、颜色等）

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 属性唯一标识符 |
| category | VARCHAR(20) | NOT NULL | 属性分类（season/style/scene/material/color/fit/pattern/occasion） |
| name | VARCHAR(100) | NOT NULL | 属性名称 |
| value | VARCHAR(100) | NULL | 属性值代码 |
| display_name | VARCHAR(100) | NULL | 显示名称（多语言支持） |
| color | VARCHAR(7) | NULL | 属性颜色代码 |
| icon | VARCHAR(50) | NULL | 属性图标 |
| parent_id | INTEGER | NULL | 父级属性ID（用于构建属性层级） |
| sort_order | INTEGER | DEFAULT 0 | 排序顺序 |
| is_active | BOOLEAN | DEFAULT TRUE | 是否启用 |
| metadata | JSON | NULL | 扩展元数据（如适用温度范围等） |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 6. 属性关联表 (entity_attributes)

**统一关联所有实体与属性**（衣物、搭配、用户偏好）

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 关联唯一标识符 |
| entity_type | VARCHAR(20) | NOT NULL | 实体类型（clothing_item/outfit/user_preference） |
| entity_id | INTEGER | NOT NULL | 实体ID |
| attribute_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES attributes(id) | 属性ID |
| user_id | INTEGER | NULL | 用户ID（用于个性化关联） |
| weight | DECIMAL(3,2) | DEFAULT 1.00 | 权重/置信度（0-1） |
| notes | TEXT | NULL | 备注信息 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |

### 7. 用户偏好配置表 (user_preferences)

存储用户个性化偏好设置

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 偏好唯一标识符 |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| preference_type | VARCHAR(30) | NOT NULL | 偏好类型（color/style/scene/season/brand/occasion） |
| preference_data | JSON | NOT NULL | 偏好数据（包含权重、偏好值等） |
| is_active | BOOLEAN | DEFAULT TRUE | 是否启用 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 8. 用户行为日志表 (user_behaviors)

记录用户行为数据，用于分析和推荐

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 行为日志ID |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| action_type | VARCHAR(30) | NOT NULL | 行为类型（view/like/share/click/filter） |
| target_type | VARCHAR(30) | NOT NULL | 目标类型（clothing/outfit/category/attribute） |
| target_id | INTEGER | NOT NULL | 目标ID |
| duration | INTEGER | NULL | 行为持续时间（毫秒） |
| metadata | JSON | NULL | 行为相关元数据 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 行为发生时间 |

### 9. 天气数据表 (weather_data)

存储天气数据，用于天气相关推荐

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 天气数据ID |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| location | VARCHAR(100) | NOT NULL | 地理位置 |
| date | DATE | NOT NULL | 日期 |
| temperature | DECIMAL(5,2) | NULL | 温度（摄氏度） |
| weather_condition | VARCHAR(50) | NULL | 天气状况（晴/雨/雪等） |
| humidity | INTEGER | NULL | 湿度（百分比） |
| wind_speed | DECIMAL(5,2) | NULL | 风速（米/秒） |
| metadata | JSON | NULL | 扩展天气数据 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 数据创建时间 |

### 10. 智能推荐结果表 (recommendations)

存储智能推荐结果

| 字段名 | 类型 | 约束 | 描述 |
|--------|------|------|------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | 推荐结果ID |
| user_id | INTEGER | NOT NULL, FOREIGN KEY REFERENCES users(id) | 用户ID |
| recommendation_type | VARCHAR(30) | NOT NULL | 推荐类型（outfit/clothing/category/combination） |
| target_id | INTEGER | NOT NULL | 推荐目标ID |
| score | DECIMAL(5,4) | NOT NULL | 推荐得分（0-1） |
| reason | TEXT | NULL | 推荐理由 |
| is_clicked | BOOLEAN | DEFAULT FALSE | 是否被点击 |
| is_liked | BOOLEAN | DEFAULT FALSE | 是否被点赞 |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | 推荐生成时间 |
| expires_at | TIMESTAMP | NULL | 推荐过期时间 |

## 完整SQL实现

### 创建表结构
```sql
-- 创建用户表
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(255),
    preferences JSON,
    style_profile JSON,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 创建衣物表
CREATE TABLE clothing_items (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    name VARCHAR(100) NOT NULL,
    brand VARCHAR(100),
    price DECIMAL(10,2),
    purchase_date DATE,
    size VARCHAR(20),
    condition VARCHAR(20) CHECK (condition IN ('全新', '良好', '一般', '较差')),
    notes TEXT,
    image_urls JSON,
    main_image_url VARCHAR(255),
    category_id INTEGER,
    color_id INTEGER,
    style_id INTEGER,
    metadata JSON,
    is_public BOOLEAN NOT NULL DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 创建搭配表
CREATE TABLE outfits (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    thumbnail_url VARCHAR(255),
    composition JSON NOT NULL,
    styling_tips TEXT,
    likes INTEGER NOT NULL DEFAULT 0,
    view_count INTEGER NOT NULL DEFAULT 0,
    share_count INTEGER NOT NULL DEFAULT 0,
    is_public BOOLEAN NOT NULL DEFAULT FALSE,
    is_featured BOOLEAN NOT NULL DEFAULT FALSE,
    metadata JSON,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 创建搭配-衣物关联表
CREATE TABLE outfit_clothing (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    outfit_id INTEGER NOT NULL,
    clothing_id INTEGER NOT NULL,
    position INTEGER DEFAULT 0,
    area VARCHAR(20),
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (outfit_id) REFERENCES outfits(id),
    FOREIGN KEY (clothing_id) REFERENCES clothing_items(id),
    UNIQUE KEY unique_outfit_clothing (outfit_id, clothing_id)
);

-- 创建属性定义表
CREATE TABLE attributes (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    category VARCHAR(20) NOT NULL,
    name VARCHAR(100) NOT NULL,
    value VARCHAR(100),
    display_name VARCHAR(100),
    color VARCHAR(7),
    icon VARCHAR(50),
    parent_id INTEGER,
    sort_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    metadata JSON,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_attribute (category, name)
);

-- 创建属性关联表
CREATE TABLE entity_attributes (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    entity_type VARCHAR(20) NOT NULL,
    entity_id INTEGER NOT NULL,
    attribute_id INTEGER NOT NULL,
    user_id INTEGER,
    weight DECIMAL(3,2) DEFAULT 1.00,
    notes TEXT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (attribute_id) REFERENCES attributes(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY unique_entity_attribute (entity_type, entity_id, attribute_id, user_id)
);

-- 创建用户偏好配置表
CREATE TABLE user_preferences (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    preference_type VARCHAR(30) NOT NULL,
    preference_data JSON NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY unique_user_preference (user_id, preference_type)
);

-- 创建用户行为日志表
CREATE TABLE user_behaviors (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    action_type VARCHAR(30) NOT NULL,
    target_type VARCHAR(30) NOT NULL,
    target_id INTEGER NOT NULL,
    duration INTEGER,
    metadata JSON,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_behavior (user_id, action_type, created_at)
);

-- 创建天气数据表
CREATE TABLE weather_data (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    location VARCHAR(100) NOT NULL,
    date DATE NOT NULL,
    temperature DECIMAL(5,2),
    weather_condition VARCHAR(50),
    humidity INTEGER,
    wind_speed DECIMAL(5,2),
    metadata JSON,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY unique_user_location_date (user_id, location, date)
);

## 初始化属性数据

### 插入基础属性分类数据
```sql
-- 插入季节属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('season', '春季', 'spring', '#90EE90', 'leaf', 1, '{"temperature_range": "10-20", "description": "温暖舒适的春季"}'),
('season', '夏季', 'summer', '#FFB6C1', 'sun', 2, '{"temperature_range": "20-35", "description": "炎热清爽的夏季"}'),
('season', '秋季', 'autumn', '#FFA500', 'tree', 3, '{"temperature_range": "10-25", "description": "凉爽宜人的秋季"}'),
('season', '冬季', 'winter', '#87CEEB', 'snowflake', 4, '{"temperature_range": "-10-10", "description": "寒冷保暖的冬季"}');

-- 插入风格属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('style', '休闲', 'casual', '#4169E1', 'tshirt', 1, '{"description": "日常舒适穿搭"}'),
('style', '正式', 'formal', '#000080', 'suit', 2, '{"description": "商务正式场合"}'),
('style', '运动', 'sport', '#228B22', 'running', 3, '{"description": "运动健身穿搭"}'),
('style', '街头', 'street', '#8B4513', 'city', 4, '{"description": "潮流街头风格"}'),
('style', '复古', 'vintage', '#8B008B', 'history', 5, '{"description": "复古怀旧风格"}'),
('style', '极简', 'minimal', '#2F4F4F', 'minus', 6, '{"description": "简约不简单"}'),
('style', '优雅', 'elegant', '#DDA0DD', 'crown', 7, '{"description": "优雅精致风格"}');

-- 插入场景属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('scene', '日常', 'daily', '#708090', 'home', 1, '{"priority": "high"}'),
('scene', '工作', 'work', '#4682B4', 'briefcase', 2, '{"priority": "high"}'),
('scene', '约会', 'date', '#FF69B4', 'heart', 3, '{"priority": "medium"}'),
('scene', '聚会', 'party', '#DA70D6', 'users', 4, '{"priority": "medium"}'),
('scene', '旅行', 'travel', '#20B2AA', 'plane', 5, '{"priority": "low"}'),
('scene', '运动', 'sport', '#32CD32', 'dumbbell', 6, '{"priority": "medium"}'),
('scene', '学院', 'academic', '#8A2BE2', 'graduation-cap', 7, '{"priority": "low"}');

-- 插入材质属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('material', '棉质', 'cotton', '#F5DEB3', 'tshirt', 1, '{"breathable": true, "comfortable": true}'),
('material', '羊毛', 'wool', '#DEB887', 'cloud', 2, '{"warm": true, "luxury": true}'),
('material', '丝绸', 'silk', '#E6E6FA', 'gem', 3, '{"smooth": true, "luxury": true}'),
('material', '牛仔', 'denim', '#4682B4', 'square', 4, '{"durable": true, "casual": true}'),
('material', '皮革', 'leather', '#8B4513', 'shield', 5, '{"durable": true, "premium": true}'),
('material', '聚酯纤维', 'polyester', '#708090', 'layer-group', 6, '{"wrinkle_resistant": true}');

-- 插入色系属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('color', '黑色系', 'black', '#000000', 'square', 1, '{"neutral": true, "versatile": true}'),
('color', '白色系', 'white', '#FFFFFF', 'square', 2, '{"neutral": true, "fresh": true}'),
('color', '灰色系', 'gray', '#808080', 'square', 3, '{"neutral": true, "versatile": true}'),
('color', '蓝色系', 'blue', '#0000FF', 'square', 4, '{"cool_tone": true, "professional": true}'),
('color', '红色系', 'red', '#FF0000', 'square', 5, '{"warm_tone": true, "bold": true}'),
('color', '绿色系', 'green', '#008000', 'square', 6, '{"natural": true, "fresh": true}'),
('color', '大地色系', 'earth', '#8B4513', 'square', 7, '{"warm": true, "natural": true}');

-- 插入版型属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('fit', '修身', 'slim', '#696969', 'ruler', 1, '{"tight": true, "modern": true}'),
('fit', '宽松', 'loose', '#A9A9A9', 'ruler', 2, '{"comfortable": true, "casual": true}'),
('fit', '标准', 'regular', '#808080', 'ruler', 3, '{"balanced": true, "versatile": true}'),
('fit', 'oversize', 'oversize', '#D3D3D3', 'ruler', 4, '{"trendy": true, "comfortable": true}');

-- 插入图案属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('pattern', '纯色', 'solid', '#D3D3D3', 'square', 1, '{"simple": true, "versatile": true}'),
('pattern', '条纹', 'stripe', '#B0C4DE', 'bars', 2, '{"classic": true, "slimming": true}'),
('pattern', '格子', 'plaid', '#778899', 'th', 3, '{"traditional": true, "academic": true}'),
('pattern', '印花', 'print', '#FFB6C1', 'image', 4, '{"decorative": true, "expressive": true}'),
('pattern', '波点', 'polka_dot', '#FFE4B5', 'circle', 5, '{"playful": true, "retro": true}');

-- 插入场合属性
INSERT INTO attributes (category, name, value, color, icon, sort_order, metadata) VALUES
('occasion', '婚礼', 'wedding', '#E6E6FA', 'ring', 1, '{"formality": "high", "priority": "high"}'),
('occasion', '面试', 'interview', '#4682B4', 'briefcase', 2, '{"formality": "high", "priority": "high"}'),
('occasion', '派对', 'party', '#DA70D6', 'users', 3, '{"formality": "medium", "priority": "medium"}'),
('occasion', '休闲聚会', 'casual_gathering', '#20B2AA', 'home', 4, '{"formality": "low", "priority": "low"}');
```

-- 创建智能推荐结果表
CREATE TABLE recommendations (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    recommendation_type VARCHAR(30) NOT NULL,
    target_id INTEGER NOT NULL,
    score DECIMAL(5,4) NOT NULL,
    reason TEXT,
    is_clicked BOOLEAN DEFAULT FALSE,
    is_liked BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_recommendation_user_type (user_id, recommendation_type, created_at)
);

### 创建高效索引
```sql
-- 用户表索引
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);

-- 衣物表索引
CREATE INDEX idx_clothing_items_user ON clothing_items(user_id);
CREATE INDEX idx_clothing_items_brand ON clothing_items(brand);
CREATE INDEX idx_clothing_items_condition ON clothing_items(condition);
CREATE INDEX idx_clothing_items_category ON clothing_items(category_id);
CREATE INDEX idx_clothing_items_public ON clothing_items(is_public);

-- 搭配表索引
CREATE INDEX idx_outfits_user ON outfits(user_id);
CREATE INDEX idx_outfits_public ON outfits(is_public);
CREATE INDEX idx_outfits_featured ON outfits(is_featured);
CREATE INDEX idx_outfits_likes ON outfits(likes);
CREATE INDEX idx_outfits_views ON outfits(view_count);

-- 搭配-衣物关联表索引
CREATE INDEX idx_outfit_clothing_outfit ON outfit_clothing(outfit_id);
CREATE INDEX idx_outfit_clothing_clothing ON outfit_clothing(clothing_id);

-- 属性表索引
CREATE INDEX idx_attributes_category ON attributes(category);
CREATE INDEX idx_attributes_name ON attributes(name);
CREATE INDEX idx_attributes_active ON attributes(is_active);
CREATE INDEX idx_attributes_parent ON attributes(parent_id);

-- 关联表索引
CREATE INDEX idx_entity_type ON entity_attributes(entity_type);
CREATE INDEX idx_entity_id ON entity_attributes(entity_id);
CREATE INDEX idx_attribute_id ON entity_attributes(attribute_id);
CREATE INDEX idx_user_id ON entity_attributes(user_id);
CREATE INDEX idx_composite_lookup ON entity_attributes(entity_type, entity_id);
CREATE INDEX idx_user_entity_lookup ON entity_attributes(user_id, entity_type);

-- 用户偏好表索引
CREATE INDEX idx_preferences_user ON user_preferences(user_id);
CREATE INDEX idx_preferences_type ON user_preferences(preference_type);
CREATE INDEX idx_preferences_active ON user_preferences(is_active);

-- 用户行为表索引
CREATE INDEX idx_behaviors_user ON user_behaviors(user_id);
CREATE INDEX idx_behaviors_action ON user_behaviors(action_type);
CREATE INDEX idx_behaviors_target ON user_behaviors(target_type);
CREATE INDEX idx_behaviors_created ON user_behaviors(created_at);

-- 天气数据表索引
CREATE INDEX idx_weather_user_location ON weather_data(user_id, location);
CREATE INDEX idx_weather_date ON weather_data(date);

-- 推荐结果表索引
CREATE INDEX idx_recommendations_user ON recommendations(user_id);
CREATE INDEX idx_recommendations_type ON recommendations(recommendation_type);
CREATE INDEX idx_recommendations_score ON recommendations(score);
CREATE INDEX idx_recommendations_expires ON recommendations(expires_at);
```

## 查询示例

### 基础查询

#### 获取衣物的所有属性
```sql
SELECT
    ci.id,
    ci.name,
    a.category,
    a.name as attribute_name,
    a.color,
    a.icon,
    ea.weight
FROM clothing_items ci
JOIN entity_attributes ea ON ci.id = ea.entity_id AND ea.entity_type = 'clothing_item'
JOIN attributes a ON ea.attribute_id = a.id
WHERE ci.user_id = 1 AND ci.id = 1
ORDER BY a.category, a.sort_order;
```

#### 按属性筛选衣物
```sql
-- 筛选：夏季 + 休闲 + 蓝色系 的衣物
SELECT DISTINCT ci.*
FROM clothing_items ci
JOIN entity_attributes ea ON ci.id = ea.entity_id AND ea.entity_type = 'clothing_item'
JOIN attributes a ON ea.attribute_id = a.id
WHERE a.category IN ('season', 'style', 'color')
  AND a.value IN ('summer', 'casual', 'blue')
  AND ci.user_id = 1
GROUP BY ci.id
HAVING COUNT(DISTINCT a.category) = 3;
```

#### 获取搭配的所有属性
```sql
SELECT
    o.id,
    o.name,
    a.category,
    a.name as attribute_name,
    a.color,
    ea.weight
FROM outfits o
JOIN entity_attributes ea ON o.id = ea.entity_id AND ea.entity_type = 'outfit'
JOIN attributes a ON ea.attribute_id = a.id
WHERE o.user_id = 1 AND o.id = 1
ORDER BY a.category, a.sort_order;
```

### 高级查询

#### 统计用户属性使用情况
```sql
-- 统计用户各属性的使用频率
SELECT
    a.category,
    a.name,
    COUNT(ea.id) as usage_count,
    AVG(ea.weight) as avg_weight
FROM attributes a
JOIN entity_attributes ea ON a.id = ea.attribute_id
JOIN clothing_items ci ON ea.entity_id = ci.id AND ea.entity_type = 'clothing_item'
WHERE ci.user_id = 1
GROUP BY a.category, a.name
ORDER BY a.category, usage_count DESC;
```

#### 智能推荐查询
```sql
-- 根据用户偏好推荐衣物
SELECT DISTINCT ci.*,
       SUM(CASE WHEN a.id IN (SELECT attribute_id FROM entity_attributes WHERE user_id = 1 AND entity_type = 'user_preference') THEN ea.weight ELSE 0 END) as preference_score
FROM clothing_items ci
JOIN entity_attributes ea ON ci.id = ea.entity_id AND ea.entity_type = 'clothing_item'
JOIN attributes a ON ea.attribute_id = a.id
WHERE ci.user_id = 1
GROUP BY ci.id
ORDER BY preference_score DESC
LIMIT 10;
```

#### 获取天气相关的搭配建议
```sql
-- 根据当前天气推荐适合的搭配
SELECT DISTINCT o.id, o.name, o.thumbnail_url,
       COUNT(DISTINCT ca.id) as matching_attributes
FROM outfits o
JOIN entity_attributes ea ON o.id = ea.entity_id AND ea.entity_type = 'outfit'
JOIN attributes a ON ea.attribute_id = a.id
JOIN weather_data w ON o.user_id = w.user_id
WHERE w.user_id = 1
  AND w.date = CURRENT_DATE
  AND a.category = 'season'
  AND a.value IN (
    SELECT CASE 
           WHEN w.temperature > 20 THEN 'summer'
           WHEN w.temperature > 10 THEN 'spring'
           WHEN w.temperature > 0 THEN 'autumn'
           ELSE 'winter' 
           END
    FROM weather_data w2 WHERE w2.id = w.id
  )
GROUP BY o.id, o.name, o.thumbnail_url
ORDER BY matching_attributes DESC
LIMIT 5;
```
    UNIQUE KEY unique_user_location_date (user_id, location, date)
);

-- 创建智能推荐结果表
CREATE TABLE recommendations (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    user_id INTEGER NOT NULL,
    recommendation_type VARCHAR(30) NOT NULL,
    target_id INTEGER NOT NULL,
    score DECIMAL(5,4) NOT NULL,
    reason TEXT,
    is_clicked BOOLEAN DEFAULT FALSE,
    is_liked BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_recommendation_user_type (user_id, recommendation_type, created_at)
);
```

### 创建高效索引
```sql
-- 用户表索引
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);

-- 衣物表索引
CREATE INDEX idx_clothing_items_user ON clothing_items(user_id);
CREATE INDEX idx_clothing_items_brand ON clothing_items(brand);
CREATE INDEX idx_clothing_items_condition ON clothing_items(condition);
CREATE INDEX idx_clothing_items_category ON clothing_items(category_id);
CREATE INDEX idx_clothing_items_color ON clothing_items(color_id);
CREATE INDEX idx_clothing_items_style ON clothing_items(style_id);
CREATE INDEX idx_clothing_items_public ON clothing_items(is_public);

-- 搭配表索引
CREATE INDEX idx_outfits_user ON outfits(user_id);
CREATE INDEX idx_outfits_public ON outfits(is_public);
CREATE INDEX idx_outfits_featured ON outfits(is_featured);
CREATE INDEX idx_outfits_likes ON outfits(likes);
CREATE INDEX idx_outfits_views ON outfits(view_count);

-- 搭配-衣物关联表索引
CREATE INDEX idx_outfit_clothing_outfit ON outfit_clothing(outfit_id);
CREATE INDEX idx_outfit_clothing_clothing ON outfit_clothing(clothing_id);

-- 属性表索引
CREATE INDEX idx_attributes_category ON attributes(category);
CREATE INDEX idx_attributes_name ON attributes(name);
CREATE INDEX idx_attributes_active ON attributes(is_active);
CREATE INDEX idx_attributes_parent ON attributes(parent_id);

-- 关联表索引
CREATE INDEX idx_entity_type ON entity_attributes(entity_type);
CREATE INDEX idx_entity_id ON entity_attributes(entity_id);
CREATE INDEX idx_attribute_id ON entity_attributes(attribute_id);
CREATE INDEX idx_user_id ON entity_attributes(user_id);
CREATE INDEX idx_composite_lookup ON entity_attributes(entity_type, entity_id);

-- 用户偏好表索引
CREATE INDEX idx_preferences_user ON user_preferences(user_id);
CREATE INDEX idx_preferences_type ON user_preferences(preference_type);
CREATE INDEX idx_preferences_active ON user_preferences(is_active);

-- 用户行为表索引
CREATE INDEX idx_behaviors_user ON user_behaviors(user_id);
CREATE INDEX idx_behaviors_action ON user_behaviors(action_type);
CREATE INDEX idx_behaviors_target ON user_behaviors(target_type);
CREATE INDEX idx_behaviors_created ON user_behaviors(created_at);

-- 天气数据表索引
CREATE INDEX idx_weather_user_location ON weather_data(user_id, location);
CREATE INDEX idx_weather_date ON weather_data(date);

-- 推荐结果表索引
CREATE INDEX idx_recommendations_user ON recommendations(user_id);
CREATE INDEX idx_recommendations_type ON recommendations(recommendation_type);
CREATE INDEX idx_recommendations_expires ON recommendations(expires_at);
```

### 初始化属性数据
```sql
-- 插入基础属性分类数据
INSERT INTO attributes (category, name, value, display_name, color, icon, sort_order, metadata) VALUES
-- 季节属性
('season', '春季', 'spring', '春季', '#90EE90', 'leaf', 1, '{"temperature_range": "10-20", "description": "温暖舒适的春季"}'),
('season', '夏季', 'summer', '夏季', '#FFB6C1', 'sun', 2, '{"temperature_range": "20-35", "description": "炎热清爽的夏季"}'),
('season', '秋季', 'autumn', '秋季', '#FFA500', 'tree', 3, '{"temperature_range": "10-25", "description": "凉爽宜人的秋季"}'),
('season', '冬季', 'winter', '冬季', '#87CEEB', 'snowflake', 4, '{"temperature_range": "-10-10", "description": "寒冷保暖的冬季"}'),

-- 风格属性
('style', '休闲', 'casual', '休闲', '#4169E1', 'tshirt', 1, '{"description": "日常舒适穿搭"}'),
('style', '正式', 'formal', '正式', '#000080', 'suit', 2, '{"description": "商务正式场合"}'),
('style', '运动', 'sport', '运动', '#228B22', 'running', 3, '{"description": "运动健身穿搭"}'),
('style', '街头', 'street', '街头', '#8B4513', 'city', 4, '{"description": "潮流街头风格"}'),
('style', '复古', 'vintage', '复古', '#8B008B', 'history', 5, '{"description": "复古怀旧风格"}'),
('style', '极简', 'minimal', '极简', '#2F4F4F', 'minus', 6, '{"description": "简约不简单"}'),
('style', '优雅', 'elegant', '优雅', '#DDA0DD', 'crown', 7, '{"description": "优雅精致风格"}'),

-- 场景属性
('scene', '日常', 'daily', '日常', '#708090', 'home', 1, '{"priority": "high"}'),
('scene', '工作', 'work', '工作', '#4682B4', 'briefcase', 2, '{"priority": "high"}'),
('scene', '约会', 'date', '约会', '#FF69B4', 'heart', 3, '{"priority": "medium"}'),
('scene', '聚会', 'party', '聚会', '#DA70D6', 'users', 4, '{"priority": "medium"}'),
('scene', '旅行', 'travel', '旅行', '#20B2AA', 'plane', 5, '{"priority": "low"}'),
('scene', '运动', 'sport', '运动', '#32CD32', 'dumbbell', 6, '{"priority": "medium"}'),
('scene', '学院', 'academic', '学院', '#8A2BE2', 'graduation-cap', 7, '{"priority": "low"}'),

-- 材质属性
('material', '棉质', 'cotton', '棉质', '#F5DEB3', 'tshirt', 1, '{"breathable": true, "comfortable": true}'),
('material', '羊毛', 'wool', '羊毛', '#DEB887', 'cloud', 2, '{"warm": true, "luxury": true}'),
('material', '丝绸', 'silk', '丝绸', '#E6E6FA', 'gem', 3, '{"smooth": true, "luxury": true}'),
('material', '牛仔', 'denim', '牛仔', '#4682B4', 'square', 4, '{"durable": true, "casual": true}'),
('material', '皮革', 'leather', '皮革', '#8B4513', 'shield', 5, '{"durable": true, "premium": true}'),
('material', '聚酯纤维', 'polyester', '聚酯纤维', '#708090', 'layer-group', 6, '{"wrinkle_resistant": true}'),

-- 色系属性
('color', '黑色系', 'black', '黑色系', '#000000', 'square', 1, '{"neutral": true, "versatile": true}'),
('color', '白色系', 'white', '白色系', '#FFFFFF', 'square', 2, '{"neutral": true, "fresh": true}'),
('color', '灰色系', 'gray', '灰色系', '#808080', 'square', 3, '{"neutral": true, "versatile": true}'),
('color', '蓝色系', 'blue', '蓝色系', '#0000FF', 'square', 4, '{"cool_tone": true, "professional": true}'),
('color', '红色系', 'red', '红色系', '#FF0000', 'square', 5, '{"warm_tone": true, "bold": true}'),
('color', '绿色系', 'green', '绿色系', '#008000', 'square', 6, '{"natural": true, "fresh": true}'),
('color', '大地色系', 'earth', '大地色系', '#8B4513', 'square', 7, '{"warm": true, "natural": true}'),

-- 版型属性
('fit', '修身', 'slim', '修身', '#696969', 'ruler', 1, '{"tight": true, "modern": true}'),
('fit', '宽松', 'loose', '宽松', '#A9A9A9', 'ruler', 2, '{"comfortable": true, "casual": true}'),
('fit', '标准', 'regular', '标准', '#808080', 'ruler', 3, '{"balanced": true, "versatile": true}'),
('fit', 'oversize', 'oversize', 'Oversize', '#D3D3D3', 'ruler', 4, '{"trendy": true, "comfortable": true}'),

-- 图案属性
('pattern', '纯色', 'solid', '纯色', '#D3D3D3', 'square', 1, '{"simple": true, "versatile": true}'),
('pattern', '条纹', 'stripe', '条纹', '#B0C4DE', 'bars', 2, '{"classic": true, "slimming": true}'),
('pattern', '格子', 'plaid', '格子', '#778899', 'th', 3, '{"traditional": true, "academic": true}'),
('pattern', '印花', 'print', '印花', '#FFB6C1', 'image', 4, '{"decorative": true, "expressive": true}'),
('pattern', '波点', 'polka_dot', '波点', '#FFE4B5', 'circle', 5, '{"playful": true, "retro": true}'),

-- 类别属性（用于衣物分类）
('category', '上装', 'tops', '上装', '#FF6B6B', 'tshirt', 1, '{"type": "clothing"}'),
('category', '下装', 'bottoms', '下装', '#4ECDC4', 'socks', 2, '{"type": "clothing"}'),
('category', '外套', 'outerwear', '外套', '#45B7D1', 'vest', 3, '{"type": "clothing"}'),
('category', '鞋履', 'shoes', '鞋履', '#96CEB4', 'shoe-prints', 4, '{"type": "clothing"}'),
('category', '配饰', 'accessories', '配饰', '#FECA57', 'gem', 5, '{"type": "clothing"}'),
('category', '包包', 'bags', '包包', '#FF9FF3', 'bag-shopping', 6, '{"type": "clothing"}'),

-- 场合属性
('occasion', '商务', 'business', '商务', '#4682B4', 'briefcase', 1, '{"formality": "high"}'),
('occasion', '休闲', 'casual', '休闲', '#4169E1', 'tshirt', 2, '{"formality": "low"}'),
('occasion', '正式', 'formal', '正式', '#000080', 'tie', 3, '{"formality": "very_high"}'),
('occasion', '派对', 'party', '派对', '#DA70D6', 'champagne-glasses', 4, '{"formality": "medium"}'),
('occasion', '运动', 'sport', '运动', '#32CD32', 'dumbbell', 5, '{"formality": "low"}'),
('occasion', '约会', 'date', '约会', '#FF69B4', 'heart', 6, '{"formality": "medium"}');
```

## 查询示例

### 基础查询

#### 获取衣物的所有属性
```sql
SELECT
    ci.id,
    ci.name,
    a.category,
    a.name as attribute_name,
    a.color,
    a.icon,
    ea.weight
FROM clothing_items ci
JOIN entity_attributes ea ON ci.id = ea.entity_id AND ea.entity_type = 'clothing_item'
JOIN attributes a ON ea.attribute_id = a.id
WHERE ci.user_id = 1 AND ci.id = 1
ORDER BY a.category, a.sort_order;
```

#### 按属性筛选衣物
```sql
-- 筛选：夏季 + 休闲 + 蓝色系 的衣物
SELECT DISTINCT ci.*
FROM clothing_items ci
JOIN entity_attributes ea ON ci.id = ea.entity_id AND ea.entity_type = 'clothing_item'
JOIN attributes a ON ea.attribute_id = a.id
WHERE a.category IN ('season', 'style', 'color')
  AND a.value IN ('summer', 'casual', 'blue')
  AND ci.user_id = 1
GROUP BY ci.id
HAVING COUNT(DISTINCT a.category) = 3;
```

#### 获取搭配的所有属性
```sql
SELECT
    o.id,
    o.name,
    a.category,
    a.name as attribute_name,
    a.color,
    ea.weight
FROM outfits o
JOIN entity_attributes ea ON o.id = ea.entity_id AND ea.entity_type = 'outfit'
JOIN attributes a ON ea.attribute_id = a.id
WHERE o.user_id = 1 AND o.id = 1
ORDER BY a.category, a.sort_order;
```

### 高级查询

#### 统计用户属性使用情况
```sql
-- 统计用户各属性的使用频率
SELECT
    a.category,
    a.name,
    COUNT(ea.id) as usage_count,
    AVG(ea.weight) as avg_weight
FROM attributes a
JOIN entity_attributes ea ON a.id = ea.attribute_id
JOIN clothing_items ci ON ea.entity_id = ci.id AND ea.entity_type = 'clothing_item'
WHERE ci.user_id = 1
GROUP BY a.category, a.name
ORDER BY a.category, usage_count DESC;
```

#### 智能推荐查询
```sql
-- 根据用户偏好推荐衣物
SELECT DISTINCT ci.*,
       SUM(CASE WHEN a.id IN (SELECT attribute_id FROM entity_attributes WHERE entity_type = 'user_preference' AND entity_id = 1) THEN ea.weight ELSE 0 END) as preference_score
FROM clothing_items ci
JOIN entity_attributes ea ON ci.id = ea.entity_id AND ea.entity_type = 'clothing_item'
JOIN attributes a ON ea.attribute_id = a.id
WHERE ci.user_id = 1
GROUP BY ci.id
ORDER BY preference_score DESC
LIMIT 10;
```

#### 基于天气的穿搭推荐
```sql
-- 根据用户所在地区当前天气推荐适合的衣物
SELECT DISTINCT ci.*
FROM clothing_items ci
JOIN entity_attributes ea ON ci.id = ea.entity_id AND ea.entity_type = 'clothing_item'
JOIN attributes a ON ea.attribute_id = a.id
JOIN weather_data wd ON wd.user_id = ci.user_id 
  AND wd.location = '北京市' 
  AND wd.date = CURDATE()
WHERE ci.user_id = 1
  AND (
    -- 温度较低时推荐保暖属性
    (wd.temperature < 10 AND a.category = 'season' AND a.value = 'winter') OR
    -- 温度适中时推荐春秋属性
    (wd.temperature BETWEEN 10 AND 20 AND a.category = 'season' AND a.value IN ('spring', 'autumn')) OR
    -- 温度较高时推荐夏季属性
    (wd.temperature > 20 AND a.category = 'season' AND a.value = 'summer')
  )
ORDER BY ci.id
LIMIT 5;
```

#### 获取热门搭配
```sql
-- 获取点赞数最高的搭配
SELECT 
    o.id,
    o.name,
    o.description,
    o.thumbnail_url,
    o.likes,
    o.view_count,
    o.share_count,
    GROUP_CONCAT(DISTINCT ca.name ORDER BY ca.sort_order SEPARATOR ', ') as categories
FROM outfits o
LEFT JOIN entity_attributes ea ON o.id = ea.entity_id AND ea.entity_type = 'outfit'
LEFT JOIN attributes ca ON ea.attribute_id = ca.id AND ca.category = 'category'
WHERE o.is_public = TRUE AND o.is_featured = TRUE
GROUP BY o.id
ORDER BY o.likes DESC, o.view_count DESC
LIMIT 10;
```

## 扩展性说明

### 新增属性类型
无需修改表结构，直接插入attributes表：

```sql
-- 新增"场合"属性类型
INSERT INTO attributes (category, name, value, display_name, color, icon, sort_order) VALUES
('occasion', '婚礼', 'wedding', '婚礼', '#E6E6FA', 'ring', 1),
('occasion', '面试', 'interview', '面试', '#4682B4', 'briefcase', 2);
```

### 新增实体类型
支持为任何新实体添加属性关联：

```sql
-- 为"收藏夹"实体添加属性
INSERT INTO entity_attributes (entity_type, entity_id, attribute_id, user_id, weight) VALUES
('collection', 1, 15, 1, 0.9);
```

## 数据表关系图

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│     users       │    │  clothing_items  │    │     outfits     │
│  (用户基础)      │───▶│   (衣物基础)      │    │   (搭配基础)     │
└─────────────────┘    └──────────────────┘    └─────────────────┘
        │                        │                        │
        │                        │                        │
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│ user_preferences│    │  attributes      │◄───┤ entity_attributes │
│   (用户偏好)     │    │  (统一属性定义)   │    │ (统一关联表)    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
        │                        │
        │                        │
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│ user_behaviors  │    │  weather_data    │    │ recommendations  │
│   (行为日志)     │    │   (天气数据)      │    │  (推荐结果)     │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

## 性能优化策略

### 1. 索引策略
- **覆盖索引**：所有查询字段都有对应索引
- **复合索引**：针对多条件查询优化
- **前缀索引**：长文本字段使用前缀索引

### 2. 缓存策略
- **属性表缓存**：attributes表全表缓存（数据量小，变化少）
- **查询结果缓存**：热门查询结果缓存到Redis
- **用户偏好缓存**：用户个性化设置缓存

### 3. 分区策略（可选）
```sql
-- 按实体类型分区
ALTER TABLE entity_attributes
PARTITION BY LIST COLUMNS(entity_type) (
    PARTITION p_clothing VALUES IN ('clothing_item'),
    PARTITION p_outfit VALUES IN ('outfit'),
    PARTITION p_preference VALUES IN ('user_preference')
);
```

## 数据迁移方案

### 从旧系统迁移
1. **用户数据**：直接迁移users表
2. **衣物数据**：迁移基础信息到clothing_items表
3. **搭配数据**：迁移基础信息到outfits表，组合关系到outfit_clothing表
4. **属性数据**：
   - 将seasons/styles/tags/scenes表数据合并到attributes表
   - 创建对应的entity_attributes关联记录

### 迁移脚本示例
```sql
-- 迁移季节属性
INSERT INTO attributes (category, name, value, display_name, color, icon)
SELECT 'season', name, LOWER(name), name,
       CASE name
           WHEN '春季' THEN '#90EE90'
           WHEN '夏季' THEN '#FFB6C1'
           WHEN '秋季' THEN '#FFA500'
           WHEN '冬季' THEN '#87CEEB'
       END,
       CASE name
           WHEN '春季' THEN 'leaf'
           WHEN '夏季' THEN 'sun'
           WHEN '秋季' THEN 'tree'
           WHEN '冬季' THEN 'snowflake'
       END
FROM seasons;

-- 迁移关联关系
INSERT INTO entity_attributes (entity_type, entity_id, attribute_id)
SELECT 'clothing_item', clothing_item_id,
       (SELECT id FROM attributes WHERE category='season' AND name=(SELECT name FROM seasons WHERE id=season_id))
FROM clothing_item_seasons;
```

## 与项目页面的对应关系

### 1. WardrobeView.vue (衣橱视图)
- **主要使用表**：clothing_items, attributes, entity_attributes
- **功能对应**：
  - 衣物分类：通过category_id和attributes表实现
  - 衣物筛选：通过entity_attributes表和属性关联实现
  - 衣物搜索：通过name, brand, notes等字段实现
  - 收藏功能：通过clothing_items表的is_public字段实现

### 2. InspirationView.vue (灵感视图)
- **主要使用表**：outfits, clothing_items, outfit_clothing, entity_attributes
- **功能对应**：
  - 搭配展示：通过outfits表和outfit_clothing关联表实现
  - 搭配创建：通过outfits表和composition JSON字段实现
  - 搭配推荐：通过recommendations表和算法实现
  - 属性筛选：通过entity_attributes表实现

### 3. 其他视图
- **WeatherView.vue**：使用weather_data表
- **StatsView.vue**：使用user_behaviors表和统计查询
- **AnalysisView.vue**：使用user_behaviors, user_preferences, recommendations表

## 总结

### 设计优势
- **极简**：10个核心表替代原有的15+个表
- **扩展**：100%属性扩展性，无需修改表结构
- **性能**：优化的索引设计，查询效率提升
- **灵活**：支持任意实体类型和属性组合
- **智能**：内置用户行为分析和推荐系统
- **完整**：覆盖了衣橱管理的所有核心功能

### 数据表数量对比
| 设计阶段 | 表数量 | 核心表 | 关联表 | 扩展性 |
|----------|--------|--------|--------|--------|
| 原始设计 | 15+个 | 8个 | 7个 | 需改结构 |
| 标签化设计 | 8个 | 5个 | 3个 | 需改结构 |
| **完善版单表** | **10个** | **6个** | **4个** | **零修改** |

### 技术亮点
1. **统一属性系统**：通过attributes和entity_attributes表实现无限扩展
2. **智能推荐引擎**：基于用户行为的个性化推荐系统
3. **天气集成**：结合天气数据提供智能穿搭建议
4. **行为分析**：记录用户行为，优化产品体验
5. **JSON字段应用**：灵活存储复杂数据结构，如搭配组成、用户偏好等

此设计方案既保留了单表设计的简洁性，又增加了智能分析和推荐功能，完全满足StyleVault项目的需求，并为未来功能扩展提供了坚实基础。
