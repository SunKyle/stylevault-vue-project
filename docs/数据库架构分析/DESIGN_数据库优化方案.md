# StyleVault æ•°æ®åº“æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“Š ç°çŠ¶æ·±åº¦åˆ†æ

### 1. è¡¨ç»“æ„è¯„ä¼°çŸ©é˜µ

| è¡¨å | è®¾è®¡è¯„åˆ† | æ€§èƒ½è¯„åˆ† | ç»´æŠ¤è¯„åˆ† | ä¸»è¦é—®é¢˜ |
|------|----------|----------|----------|----------|
| **clothing** | 9/10 | 8/10 | 9/10 | å·²ä¼˜åŒ–ï¼Œç»“æ„åˆç† |
| **users** | 7/10 | 8/10 | 8/10 | JSONå­—æ®µä½¿ç”¨éœ€è°¨æ… |
| **outfits** | 8/10 | 7/10 | 8/10 | ç¼ºå°‘å¤åˆç´¢å¼• |
| **outfit_clothing** | 9/10 | 8/10 | 9/10 | å…³è”è¡¨è®¾è®¡è‰¯å¥½ |
| **attributes** | 6/10 | 5/10 | 6/10 | å±‚çº§ç»“æ„å¤æ‚ï¼ŒæŸ¥è¯¢ä½æ•ˆ |
| **recommendations** | 5/10 | 4/10 | 6/10 | ç©ºè¡¨ï¼Œè®¾è®¡å¾…éªŒè¯ |
| **user_behaviors** | 7/10 | 6/10 | 7/10 | è¡Œä¸ºç±»å‹æšä¸¾éœ€ä¼˜åŒ– |
| **user_preferences** | 8/10 | 7/10 | 8/10 | JSONå­—æ®µç¼ºä¹éªŒè¯ |
| **weather_data** | 4/10 | 3/10 | 5/10 | ç©ºè¡¨ï¼Œæ•°æ®æ¨¡å‹å¾…å®Œå–„ |

## ğŸ” æ ¸å¿ƒé—®é¢˜è¯†åˆ«

### 1. è®¾è®¡å±‚é¢é—®é¢˜

#### A. æ•°æ®å†—ä½™ä¸èŒƒå¼åŒ–
- **attributesè¡¨**ï¼šå±‚çº§ç»“æ„å¯¼è‡´æ•°æ®é‡å¤å­˜å‚¨
- **ç”¨æˆ·åå¥½å­˜å‚¨**ï¼šJSONå­—æ®µç¼ºä¹ç»“æ„åŒ–éªŒè¯
- **æšä¸¾å€¼ç®¡ç†**ï¼šéƒ¨åˆ†æšä¸¾å€¼åˆ†æ•£åœ¨å¤šä¸ªè¡¨ä¸­

#### B. æ‰©å±•æ€§é—®é¢˜
- **clothingè¡¨**ï¼šå·²ä¼˜åŒ–ï¼Œä½†æœªæ¥å±æ€§æ‰©å±•éœ€è€ƒè™‘
- **weather_data**ï¼šå½“å‰æ¨¡å‹è¿‡äºç®€å•ï¼Œæ— æ³•æ”¯æŒå¤æ‚å¤©æ°”åˆ†æ
- **recommendations**ï¼šç¼ºå°‘æ¨èç®—æ³•æ‰€éœ€çš„å…³é”®å­—æ®µ

#### C. æ•°æ®å®Œæ•´æ€§
- **å¤–é”®çº¦æŸ**ï¼šéƒ¨åˆ†è¡¨ä½¿ç”¨NO ACTIONè€ŒéCASCADE
- **å”¯ä¸€çº¦æŸ**ï¼šuser_preferencesç¼ºå°‘ä¸šåŠ¡å”¯ä¸€çº¦æŸ
- **é»˜è®¤å€¼**ï¼šéƒ¨åˆ†å…³é”®å­—æ®µç¼ºå°‘åˆç†é»˜è®¤å€¼

### 2. æ€§èƒ½å±‚é¢é—®é¢˜

#### A. ç´¢å¼•ç­–ç•¥
- **attributesè¡¨**ï¼šç´¢å¼•é€‰æ‹©æ€§ä½ï¼Œpathç´¢å¼•æ•ˆç‡å·®
- **weather_data**ï¼šç¼ºå°‘æ—¶é—´åºåˆ—æŸ¥è¯¢ç´¢å¼•
- **å¤åˆç´¢å¼•**ï¼šç¼ºå°‘é’ˆå¯¹ä¸šåŠ¡æŸ¥è¯¢çš„å¤åˆç´¢å¼•

#### B. æŸ¥è¯¢æ•ˆç‡
- **å±‚çº§æŸ¥è¯¢**ï¼šattributesè¡¨çš„å±‚çº§æŸ¥è¯¢éœ€è¦é€’å½’ï¼Œæ€§èƒ½å·®
- **å…³è”æŸ¥è¯¢**ï¼šç¼ºå°‘è¦†ç›–ç´¢å¼•ï¼Œå›è¡¨æ“ä½œå¤š
- **JSONæŸ¥è¯¢**ï¼šJSONå­—æ®µæŸ¥è¯¢æ— æ³•ä½¿ç”¨ç´¢å¼•

#### C. å­˜å‚¨ä¼˜åŒ–
- **å­—æ®µç±»å‹**ï¼šéƒ¨åˆ†varcharé•¿åº¦è®¾ç½®ä¸åˆç†
- **JSONå­—æ®µ**ï¼šä½¿ç”¨è¿‡åº¦ï¼Œéƒ¨åˆ†åº”ç»“æ„åŒ–å­˜å‚¨
- **æ—¶é—´å­˜å‚¨**ï¼šç¼ºå°‘æ—¶åŒºè€ƒè™‘

### 3. å¯ç»´æŠ¤æ€§é—®é¢˜

#### A. å‘½åè§„èŒƒ
- **ä¸€è‡´æ€§**ï¼šéƒ¨åˆ†å­—æ®µå‘½åä¸ç»Ÿä¸€ï¼ˆå¦‚user_id vs users_idï¼‰
- **è¯­ä¹‰æ¸…æ™°**ï¼šéƒ¨åˆ†å­—æ®µå«ä¹‰ä¸æ˜ç¡®

#### B. æ–‡æ¡£å®Œæ•´æ€§
- **è¡¨æ³¨é‡Š**ï¼šéƒ¨åˆ†è¡¨ç¼ºå°‘ä¸šåŠ¡æ³¨é‡Š
- **å­—æ®µæ³¨é‡Š**ï¼šæšä¸¾å€¼å«ä¹‰æœªæ–‡æ¡£åŒ–

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡

### 1. æ¶æ„ä¼˜åŒ–è·¯çº¿å›¾

```mermaid
graph TD
    A[å½“å‰æ¶æ„] --> B[çŸ­æœŸä¼˜åŒ–]
    B --> C[ä¸­æœŸé‡æ„]
    C --> D[é•¿æœŸæ¼”è¿›]
    
    B1[ç´¢å¼•ä¼˜åŒ–] --> B2[çº¦æŸå®Œå–„]
    B2 --> B3[å­—æ®µè°ƒæ•´]
    
    C1[è¡¨ç»“æ„è°ƒæ•´] --> C2[æ•°æ®è¿ç§»]
    C2 --> C3[æ€§èƒ½éªŒè¯]
    
    D1[åˆ†åº“åˆ†è¡¨] --> D2[ç¼“å­˜å±‚]
    D3[è¯»å†™åˆ†ç¦»]
```

### 2. çŸ­æœŸä¼˜åŒ–æ–¹æ¡ˆï¼ˆ1-2å‘¨ï¼‰

#### A. ç´¢å¼•ä¼˜åŒ–
```sql
-- ä¸ºé«˜é¢‘æŸ¥è¯¢æ·»åŠ å¤åˆç´¢å¼•
CREATE INDEX idx_clothing_user_category ON clothing(user_id, category, status);
CREATE INDEX idx_clothing_user_brand ON clothing(user_id, brand, status);
CREATE INDEX idx_outfits_user_season ON outfits(user_id, season, status);
CREATE INDEX idx_user_behaviors_time ON user_behaviors(user_id, created_at);

-- ä¼˜åŒ–attributesè¡¨æŸ¥è¯¢
CREATE INDEX idx_attributes_path_level ON attributes(path(100), level);
CREATE INDEX idx_attributes_category_type ON attributes(category, type, is_active);
```

#### B. çº¦æŸå®Œå–„
```sql
-- æ·»åŠ ä¸šåŠ¡çº¦æŸ
ALTER TABLE user_preferences 
ADD UNIQUE KEY unique_user_preference_type (user_id, preference_type);

-- å®Œå–„å¤–é”®çº¦æŸ
ALTER TABLE recommendations 
DROP FOREIGN KEY recommendations_ibfk_1,
ADD CONSTRAINT fk_recommendations_user 
FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE;
```

#### C. å­—æ®µè°ƒæ•´
```sql
-- ä¼˜åŒ–å­—æ®µç±»å‹
ALTER TABLE clothing 
MODIFY size VARCHAR(10),
MODIFY notes TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æ·»åŠ ç¼ºå¤±å­—æ®µ
ALTER TABLE weather_data 
ADD COLUMN weather_code VARCHAR(10),
ADD COLUMN temperature_min DECIMAL(5,2),
ADD COLUMN temperature_max DECIMAL(5,2);
```

### 3. ä¸­æœŸé‡æ„æ–¹æ¡ˆï¼ˆ1-2æœˆï¼‰

#### A. è¡¨ç»“æ„é‡æ„

##### 1. ä¼˜åŒ–attributesè¡¨è®¾è®¡
```sql
-- åˆ›å»ºæ–°çš„å±æ€§åˆ†ç±»è¡¨
CREATE TABLE attribute_categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE,
    description TEXT,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç®€åŒ–attributesè¡¨ç»“æ„
CREATE TABLE attributes_v2 (
    id INT PRIMARY KEY AUTO_INCREMENT,
    category_id INT NOT NULL,
    name VARCHAR(100) NOT NULL,
    value VARCHAR(100),
    display_name VARCHAR(100),
    color VARCHAR(7),
    sort_order INT DEFAULT 0,
    is_active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES attribute_categories(id),
    UNIQUE KEY unique_category_name (category_id, name)
);
```

##### 2. æ¨èç³»ç»Ÿæ•°æ®æ¨¡å‹
```sql
-- ç”¨æˆ·ç”»åƒè¡¨
CREATE TABLE user_profiles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL UNIQUE,
    style_preferences JSON,
    color_preferences JSON,
    brand_preferences JSON,
    price_range_min DECIMAL(10,2),
    price_range_max DECIMAL(10,2),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- æ¨èè§„åˆ™è¡¨
CREATE TABLE recommendation_rules (
    id INT PRIMARY KEY AUTO_INCREMENT,
    rule_name VARCHAR(100) NOT NULL,
    rule_type ENUM('similarity','seasonal','trending','personal') NOT NULL,
    conditions JSON NOT NULL,
    weight DECIMAL(3,2) DEFAULT 1.0,
    is_active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### B. æ€§èƒ½ä¼˜åŒ–

##### 1. åˆ†åŒºç­–ç•¥
```sql
-- æŒ‰æ—¶é—´åˆ†åŒºç”¨æˆ·è¡Œä¸ºè¡¨
ALTER TABLE user_behaviors 
PARTITION BY RANGE (YEAR(created_at)) (
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p2026 VALUES LESS THAN (2027)
);
```

##### 2. ç¼“å­˜è¡¨è®¾è®¡
```sql
-- ç”¨æˆ·ç»Ÿè®¡æ•°æ®ç¼“å­˜
CREATE TABLE user_statistics (
    user_id INT PRIMARY KEY,
    total_clothing INT DEFAULT 0,
    total_outfits INT DEFAULT 0,
    favorite_category VARCHAR(50),
    total_spent DECIMAL(15,2) DEFAULT 0,
    last_activity_at TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 4. é•¿æœŸæ¼”è¿›æ–¹æ¡ˆï¼ˆ3-6æœˆï¼‰

#### A. å¾®æœåŠ¡æ¶æ„æ”¯æŒ
```sql
-- ç”¨æˆ·æœåŠ¡ç‹¬ç«‹æ•°æ®åº“
CREATE DATABASE stylevault_users;
CREATE DATABASE stylevault_inventory;
CREATE DATABASE stylevault_recommendations;

-- åˆ†å¸ƒå¼IDç”Ÿæˆ
CREATE TABLE id_generator (
    id_name VARCHAR(50) PRIMARY KEY,
    current_id BIGINT DEFAULT 0,
    increment_by INT DEFAULT 1,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### B. å®æ—¶æ•°æ®å¤„ç†
```sql
-- äº‹ä»¶æµè¡¨
CREATE TABLE event_stream (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    event_type VARCHAR(50) NOT NULL,
    user_id INT,
    entity_type VARCHAR(50),
    entity_id INT,
    event_data JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP NULL,
    INDEX idx_event_type_time (event_type, created_at),
    INDEX idx_user_events (user_id, created_at)
);
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æµ‹è¯•æ–¹æ¡ˆ

### 1. æµ‹è¯•æ•°æ®é›†
```sql
-- ç”Ÿæˆæµ‹è¯•æ•°æ®
-- 1000ç”¨æˆ·ï¼Œ50000è¡£ç‰©ï¼Œ100000è¡Œä¸ºè®°å½•
CALL generate_test_data(1000, 50000, 100000);
```

### 2. å…³é”®æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
```sql
-- ç”¨æˆ·è¡£ç‰©æŸ¥è¯¢æ€§èƒ½
EXPLAIN ANALYZE SELECT * FROM clothing 
WHERE user_id = 123 AND category = 'tops' AND status = 'active';

-- ç©¿æ­æ¨èæŸ¥è¯¢
EXPLAIN ANALYZE SELECT o.* FROM outfits o 
JOIN outfit_clothing oc ON o.id = oc.outfit_id 
WHERE o.user_id = 123 AND o.season = 'summer';
```

### 3. ç›‘æ§æŒ‡æ ‡
- æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms (95th percentile)
- ç´¢å¼•å‘½ä¸­ç‡ > 95%
- è¿æ¥æ± åˆ©ç”¨ç‡ < 80%
- ç£ç›˜I/Oç­‰å¾… < 10ms

## ğŸš€ å®æ–½ä¼˜å…ˆçº§

### P0 - ç«‹å³æ‰§è¡Œï¼ˆæœ¬å‘¨ï¼‰
1. æ·»åŠ å…³é”®å¤åˆç´¢å¼•
2. å®Œå–„å¤–é”®çº¦æŸ
3. ä¿®å¤å­—æ®µç±»å‹é—®é¢˜

### P1 - è¿‘æœŸä¼˜åŒ–ï¼ˆæœ¬æœˆï¼‰
1. attributesè¡¨ç»“æ„ç®€åŒ–
2. ç”¨æˆ·ç”»åƒè¡¨è®¾è®¡
3. ç¼“å­˜è¡¨å®ç°

### P2 - ä¸­æœŸè§„åˆ’ï¼ˆä¸‹å­£åº¦ï¼‰
1. åˆ†åŒºè¡¨å®æ–½
2. è¯»å†™åˆ†ç¦»æ¶æ„
3. ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

### P3 - é•¿æœŸæ¼”è¿›ï¼ˆæ˜å¹´ï¼‰
1. å¾®æœåŠ¡æ•°æ®åº“æ‹†åˆ†
2. å®æ—¶æ•°æ®ç®¡é“
3. AI/MLé›†æˆä¼˜åŒ–