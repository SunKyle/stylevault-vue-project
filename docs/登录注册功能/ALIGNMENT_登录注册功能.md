# 登录注册功能需求梳理文档

## 项目背景
StyleVault是一个智能穿搭管理应用，当前需要实现完整的用户登录注册功能，将现有的模拟实现替换为真实的后端API。

## 当前状态分析

### 前端现状
- **技术栈**: Vue 3 + Vite + TypeScript + TailwindCSS + Pinia
- **登录页面**: `/front/src/views/LoginPage.vue`已存在，包含完整的UI和前端验证
- **API层**: 已存在适配器模式，支持Mock和真实API切换
- **状态管理**: 已存在authStore用于管理认证状态

### 后端现状
- **技术栈**: Node.js + TypeScript + Express.js + Sequelize + MySQL
- **认证方案**: JWT Token认证
- **数据库**: MySQL已配置，支持用户表
- **API规范**: RESTful API，版本控制(/api/v1)

## 需求边界确认

### 明确需求
1. **保持现有UI不变**: 登录注册页面的样式、动画、布局完全保持不变
2. **实现真实API**: 将模拟登录注册替换为真实后端API调用
3. **JWT认证**: 实现基于JWT的认证机制
4. **错误处理**: 完善的错误提示和用户体验
5. **状态同步**: 登录状态在前端正确同步

### 任务范围
- ✅ 用户注册API (POST /api/v1/auth/register)
- ✅ 用户登录API (POST /api/v1/auth/login)
- ✅ JWT Token管理
- ✅ 前端API集成
- ✅ 错误处理和用户反馈
- ✅ 登录状态持久化

### 不包含范围
- ❌ 第三方登录 (微信、QQ等)
- ❌ 忘记密码功能
- ❌ 邮箱验证
- ❌ 用户头像上传
- ❌ 用户资料编辑

## 技术约束

### 前端约束
- 保持现有组件结构不变
- 使用现有的API适配器模式
- 保持现有的错误提示样式
- 不改变现有的表单验证逻辑

### 后端约束
- 使用现有的项目结构
- 遵循RESTful API设计规范
- 使用JWT进行认证
- 密码加密存储(bcrypt)
- 统一的响应格式

### 数据库约束
- 使用现有的users表结构
- 支持用户注册信息存储
- 支持密码验证

## 需求理解

### 用户注册流程
1. 用户填写注册表单(用户名、邮箱、密码、确认密码)
2. 前端进行表单验证
3. 调用注册API
4. 后端验证邮箱唯一性
5. 创建用户记录
6. 返回成功响应
7. 前端自动跳转到登录表单并预填邮箱

### 用户登录流程
1. 用户填写登录表单(邮箱、密码)
2. 前端进行表单验证
3. 调用登录API
4. 后端验证用户凭证
5. 返回JWT Token
6. 前端存储Token到localStorage
7. 跳转到衣橱管理页面

### 错误处理需求
- 网络错误: 显示"网络错误，请检查网络连接"
- 服务器错误: 显示"服务器错误，请稍后再试"
- 认证错误: 显示"用户名或密码错误"
- 注册冲突: 显示"该邮箱已被注册"

## 疑问澄清

### 需要确认的问题
1. **用户名字段**: 注册时是否需要用户名？当前表单有用户名字段
2. **记住我功能**: 登录表单的"记住我"复选框是否需要实现？
3. **Token有效期**: JWT Token的过期时间设置多久合适？
4. **注册后行为**: 注册成功后是自动登录还是跳转到登录页面？
5. **密码强度**: 是否需要密码强度验证？最小长度要求？

### 已确认决策
- 需要用户名字段，作为显示名称
- "记住我"功能暂不实现，Token默认7天有效期
- 注册成功后跳转到登录页面，预填邮箱但不自动登录
- 密码最小长度6位，无需复杂强度验证

## 项目特性规范

### API响应格式
```json
{
  "success": true,
  "message": "操作成功",
  "data": { ... },
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

### 错误响应格式
```json
{
  "success": false,
  "message": "错误描述",
  "error": { ... },
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

### 认证Token格式
- Header: `Authorization: Bearer <token>`
- Token存储: localStorage
- Token键名: `stylevault_token`

### 用户数据结构
```typescript
interface User {
  id: number;
  username: string;
  email: string;
  password: string; // 加密存储
  createdAt: Date;
  updatedAt: Date;
}
```