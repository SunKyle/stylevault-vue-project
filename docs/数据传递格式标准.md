# StyleVault 数据传递格式标准

## 1. 概述

本标准旨在规范 StyleVault 项目前后端及各组件间的数据传递格式，确保数据交换的一致性、可读性和可维护性。标准覆盖数据结构定义、字段命名规范、数据类型约束、错误处理机制、状态码定义、分页数据格式、日期时间格式、特殊数据类型处理等方面。

## 2. 数据结构定义

### 2.1 基础数据结构

所有 API 响应应遵循统一的基础数据结构：

```typescript
interface ApiResponse<T = any> {
  success: boolean;      // 请求是否成功
  data?: T;              // 成功时返回的数据
  message?: string;      // 操作结果描述
  error?: ErrorDetail;   // 错误时返回的详细信息
  timestamp: string;     // 响应时间戳
}

interface ErrorDetail {
  code: string;          // 错误代码
  details: string;       // 错误详情
  fields?: FieldError[]; // 字段级错误信息
}

interface FieldError {
  field: string;         // 错误字段名
  message: string;       // 字段错误描述
}
```

### 2.2 分页数据结构

对于列表查询接口，应使用分页数据结构：

```typescript
interface PaginatedResponse<T> {
  items: T[];            // 数据列表
  pagination: PaginationMeta;
}

interface PaginationMeta {
  page: number;          // 当前页码（从1开始）
  limit: number;         // 每页数量
  total: number;         // 总记录数
  totalPages: number;    // 总页数
  hasNext: boolean;      // 是否有下一页
  hasPrev: boolean;      // 是否有上一页
}
```

### 2.3 组件间数据传递结构

组件间传递数据应遵循以下结构：

```typescript
// Props 传递结构
interface ComponentProps<T = any> {
  data: T;               // 主要数据
  config?: ConfigOptions; // 配置选项
  loading?: boolean;     // 加载状态
}

interface ConfigOptions {
  [key: string]: any;    // 组件配置项
}

// 事件传递结构
interface ComponentEvent<T = any> {
  type: string;          // 事件类型
  payload: T;            // 事件数据
  timestamp: number;     // 事件时间戳
}
```

## 3. 字段命名规范

### 3.1 通用命名规范

| 场景       | 命名规则    | 示例                        |
| ---------- | ----------- | --------------------------- |
| API 路径   | 小写+连字符 | `/clothing-items`           |
| 查询参数   | 驼峰命名    | `?page=1&limit=10`          |
| 请求体字段 | 驼峰命名    | `{ "userName": "test" }`    |
| 响应体字段 | 驼峰命名    | `{ "userId": 123 }`         |
| 数据库字段 | 下划线命名  | `user_id`                   |
| 组件 props | 驼峰命名    | `:itemData="data"`          |
| 组件事件   | 短横线命名  | `@item-click="handleClick"` |
| 状态管理   | 驼峰命名    | `clothingStore`             |

### 3.2 特殊字段命名

| 字段类型 | 命名规则              | 示例                                       |
| -------- | --------------------- | ------------------------------------------ |
| ID 字段  | 统一使用 `id`         | `id: 123`                                  |
| 用户 ID  | `userId`              | `userId: 123`                              |
| 创建时间 | `createdAt`           | `createdAt: "2023-01-01T12:00:00Z"`        |
| 更新时间 | `updatedAt`           | `updatedAt: "2023-01-01T12:00:00Z"`        |
| 删除时间 | `deletedAt`           | `deletedAt: "2023-01-01T12:00:00Z"`        |
| 布尔字段 | 以 `is` 或 `has` 开头 | `isFavorite: true`, `hasPermission: false` |
| 状态字段 | `status`              | `status: "active"`                         |
| 名称字段 | `name` 或具体名称     | `name: "T恤"`, `displayName: "短袖T恤"`    |

## 4. 数据类型约束

### 4.1 基本数据类型

| 数据类型    | 描述                     | 示例                 |
| ----------- | ------------------------ | -------------------- |
| `string`    | 字符串类型               | `"test"`             |
| `number`    | 数字类型（整数或浮点数） | `123`, `123.45`      |
| `boolean`   | 布尔类型                 | `true`, `false`      |
| `null`      | 空值                     | `null`               |
| `undefined` | 未定义                   | `undefined`          |
| `object`    | 对象类型                 | `{ "key": "value" }` |
| `array`     | 数组类型                 | `[1, 2, 3]`          |

### 4.2 特殊数据类型

| 数据类型   | 描述                          | 示例                                     |
| ---------- | ----------------------------- | ---------------------------------------- |
| `date`     | 日期类型（ISO 8601 格式）     | `"2023-01-01"`                           |
| `datetime` | 日期时间类型（ISO 8601 格式） | `"2023-01-01T12:00:00Z"`                 |
| `time`     | 时间类型（ISO 8601 格式）     | `"12:00:00Z"`                            |
| `uuid`     | UUID 类型                     | `"550e8400-e29b-41d4-a716-446655440000"` |
| `url`      | URL 类型                      | `"https://example.com"`                  |
| `email`    | 邮箱类型                      | `"test@example.com"`                     |
| `phone`    | 电话号码类型                  | `"+8613800138000"`                       |

### 4.3 数据类型转换规则

| 数据库类型 | 前端类型            | 转换规则               |
| ---------- | ------------------- | ---------------------- |
| `INT`      | `number`            | 直接转换               |
| `DECIMAL`  | `number`            | 转换为浮点数           |
| `VARCHAR`  | `string`            | 直接转换               |
| `TEXT`     | `string`            | 直接转换               |
| `BOOLEAN`  | `boolean`           | 直接转换               |
| `DATETIME` | `string`            | 转换为 ISO 8601 格式   |
| `DATE`     | `string`            | 转换为 YYYY-MM-DD 格式 |
| `JSON`     | `object` 或 `array` | 解析为 JSON 对象或数组 |

## 5. 错误处理机制

### 5.1 错误代码规范

| 错误类型   | 错误代码前缀 | 示例                   |
| ---------- | ------------ | ---------------------- |
| 系统错误   | `SYS_`       | `SYS_INTERNAL_ERROR`   |
| 认证错误   | `AUTH_`      | `AUTH_INVALID_TOKEN`   |
| 权限错误   | `PERM_`      | `PERM_FORBIDDEN`       |
| 验证错误   | `VALID_`     | `VALID_REQUIRED_FIELD` |
| 业务错误   | `BUS_`       | `BUS_ITEM_NOT_FOUND`   |
| 数据库错误 | `DB_`        | `DB_DUPLICATE_KEY`     |
| 网络错误   | `NET_`       | `NET_TIMEOUT`          |

### 5.2 错误响应格式

```json
{
  "success": false,
  "message": "操作失败",
  "error": {
    "code": "BUS_ITEM_NOT_FOUND",
    "details": "衣物不存在",
    "fields": [
      {
        "field": "id",
        "message": "无效的衣物ID"
      }
    ]
  },
  "timestamp": "2023-01-01T12:00:00Z"
}
```

### 5.3 前端错误处理

1. **全局错误处理**：使用 Vue 错误处理机制捕获全局错误
2. **API 错误处理**：统一处理 API 响应中的错误
3. **用户友好提示**：将错误信息转换为用户友好的提示
4. **错误日志记录**：记录关键错误信息便于调试

## 6. 状态码定义

### 6.1 HTTP 状态码

| 状态码 | 含义                   | 应用场景               |
| ------ | ---------------------- | ---------------------- |
| `200`  | OK                     | 请求成功               |
| `201`  | Created                | 资源创建成功           |
| `202`  | Accepted               | 请求已接受，处理中     |
| `204`  | No Content             | 请求成功，无返回内容   |
| `400`  | Bad Request            | 请求参数错误或验证失败 |
| `401`  | Unauthorized           | 未授权或认证失败       |
| `403`  | Forbidden              | 权限不足               |
| `404`  | Not Found              | 资源不存在             |
| `405`  | Method Not Allowed     | 请求方法不允许         |
| `409`  | Conflict               | 数据冲突               |
| `413`  | Payload Too Large      | 请求体过大             |
| `415`  | Unsupported Media Type | 不支持的媒体类型       |
| `500`  | Internal Server Error  | 服务器内部错误         |
| `502`  | Bad Gateway            | 网关错误               |
| `503`  | Service Unavailable    | 服务不可用             |
| `504`  | Gateway Timeout        | 网关超时               |

### 6.2 业务状态码

| 状态码 | 含义     | 应用场景           |
| ------ | -------- | ------------------ |
| `0`    | 成功     | 业务操作成功       |
| `1000` | 参数错误 | 请求参数不符合要求 |
| `1001` | | 资源不存在 | 请求的资源不存在 |
| `1002` | 资源已存在 | 尝试创建已存在的资源 |
| `1003` | 操作失败 | 业务操作执行失败 |
| `1004` | 权限不足 | 用户无权限执行该操作 |
| `1005` | 认证失败 | 用户认证失败 |
| `1006` | 限流 | 请求频率超过限制 |
| `1007` | 系统错误 | 系统内部错误 |
| `1008` | 数据校验失败 | 数据校验不通过 |

## 7. 分页数据格式

### 7.1 分页请求参数

| 参数名 | 类型 | 描述 | 默认值 |
|--------|------|------|--------|
| `page` | `number` | 当前页码 | `1` |
| `limit` | `number` | 每页数量 | `10` |
| `sortBy` | `string` | 排序字段 | 按创建时间倒序 |
| `sortOrder` | `string` | 排序方向 (`asc` 或 `desc`) | `desc` |

### 7.2 分页响应格式

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "name": "T恤",
        "createdAt": "2023-01-01T12:00:00Z"
      },
      {
        "id": 2,
        "name": "牛仔裤",
        "createdAt": "2023-01-02T12:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 2,
      "totalPages": 1,
      "hasNext": false,
      "hasPrev": false
    }
  },
  "message": "查询成功",
  "timestamp": "2023-01-03T12:00:00Z"
}
```

## 8. 日期时间格式

### 8.1 统一格式

所有日期时间数据应使用 ISO 8601 格式：

| 数据类型 | 格式 | 示例 |
|----------|------|------|
| 日期时间 | `YYYY-MM-DDTHH:mm:ss.SSSZ` | `2023-01-01T12:00:00.000Z` |
| 日期 | `YYYY-MM-DD` | `2023-01-01` |
| 时间 | `HH:mm:ss` | `12:00:00` |

### 8.2 时间处理规则

1. 所有日期时间数据在后端存储时应使用 UTC 时间
2. 后端返回给前端的日期时间数据应转换为 ISO 8601 格式
3. 前端展示时应根据用户时区转换为本地时间
4. 前端向后端发送日期时间数据时应使用 ISO 8601 格式

## 9. 特殊数据类型处理方式

### 9.1 JSON 数据处理

1. 数据库中的 JSON 字段应转换为前端的对象或数组
2. 前端向后端发送 JSON 数据时应转换为字符串
3. JSON 数据应包含完整的类型信息
4. 复杂 JSON 数据应定义明确的结构

### 9.2 图片数据处理

1. 图片数据应使用 URL 格式存储
2. 图片上传时应返回完整的图片 URL
3. 支持多种图片尺寸的 URL 生成
4. 图片 URL 应包含版本信息，便于缓存管理

### 9.3 枚举数据处理

1. 枚举数据应使用标准的键值对格式
2. 枚举值应包含显示名称和描述信息
3. 枚举数据应在前端进行缓存，减少重复请求
4. 枚举数据变更时应提供版本管理机制

### 9.4 数组数据处理

1. 数组数据应使用标准的 JSON 数组格式
2. 空数组应返回 `[]`，而不是 `null` 或 `undefined`
3. 数组数据应包含明确的类型信息
4. 大型数组应考虑分页处理

## 10. API 设计规范

### 10.1 RESTful API 规范

| 操作 | HTTP 方法 | 路径示例 | 描述 |
|------|-----------|----------|------|
| 查询 | `GET` | `/clothing-items` | 获取衣物列表 |
| 详情 | `GET` | `/clothing-items/:id` | 获取衣物详情 |
| 创建 | `POST` | `/clothing-items` | 创建衣物 |
| 更新 | `PUT` | `/clothing-items/:id` | 更新衣物 |
| 部分更新 | `PATCH` | `/clothing-items/:id` | 部分更新衣物 |
| 删除 | `DELETE` | `/clothing-items/:id` | 删除衣物 |
| 批量操作 | `POST` | `/clothing-items/batch` | 批量操作衣物 |

### 10.2 API 版本管理

1. API 版本应通过 URL 路径前缀进行管理，如 `/v1/clothing-items`
2. 版本号应使用整数，如 `v1`, `v2`
3. 旧版本 API 应提供至少 6 个月的支持期
4. API 版本变更应提供详细的迁移指南

### 10.3 API 文档规范

1. 使用 Swagger/OpenAPI 生成 API 文档
2. 每个 API 端点应包含详细的描述、参数、响应格式和示例
3. API 文档应包含错误代码和含义说明
4. API 文档应实时更新，与代码保持一致

## 11. 组件间数据传递规范

### 11.1 Props 传递规范

1. Props 应使用驼峰命名
2. Props 应提供明确的类型定义
3. Props 应设置默认值
4. 复杂数据应使用对象形式传递
5. 避免传递过多的 Props，可考虑使用 `v-bind` 传递对象

### 11.2 事件传递规范

1. 事件应使用短横线命名
2. 事件数据应包含明确的类型信息
3. 事件应提供详细的文档说明
4. 避免使用过多的事件，可考虑使用状态管理

### 11.3 状态管理规范

1. 使用 Pinia 进行状态管理
2. 状态应按功能模块进行划分
3. 状态应提供明确的类型定义
4. 状态变更应通过 actions 进行
5. 复杂状态应使用 getter 进行计算

## 12. 数据验证规范

### 12.1 前端验证

1. 表单数据应在前端进行即时验证
2. 验证规则应与后端保持一致
3. 验证错误应提供明确的提示信息
4. 提交前应进行完整的验证

### 12.2 后端验证

1. 所有 API 请求应在后端进行验证
2. 使用 Joi 或其他验证库进行验证
3. 验证错误应返回详细的字段错误信息
4. 验证规则应集中管理，便于维护

## 13. 安全性规范

### 13.1 数据加密

1. 敏感数据应在传输过程中进行加密
2. 使用 HTTPS 协议进行数据传输
3. 密码应使用 bcrypt 或其他安全算法进行哈希存储
4. 敏感数据在前端展示时应进行脱敏处理

### 13.2 数据过滤

1. 所有用户输入应进行过滤，防止 XSS 攻击
2. 数据库查询应使用参数化查询，防止 SQL 注入
3. 文件上传应进行类型和大小限制
4. API 请求应进行速率限制，防止 DDoS 攻击

### 13.3 数据权限

1. 数据访问应基于用户权限进行控制
2. 用户只能访问自己的数据
3. 敏感数据应提供细粒度的权限控制
4. 权限变更应进行日志记录

## 14. 最佳实践

### 14.1 数据传递优化

1. 减少不必要的数据传递
2. 使用分页减少单次请求的数据量
3. 合理使用缓存减少重复请求
4. 使用压缩减少数据传输量

### 14.2 数据一致性

1. 前后端数据结构应保持一致
2. 数据类型转换应严格遵循规范
3. 数据更新应使用原子操作
4. 分布式系统应考虑数据一致性问题

### 14.3 可维护性

1. 数据结构应易于扩展
2. 字段命名应具有描述性
3. 数据类型应明确，避免使用模糊类型
4. 数据传递应具有明确的文档说明

## 15. 示例应用

### 15.1 API 响应示例

#### 成功响应

```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "T恤",
    "category": {
      "id": 1,
      "name": "上衣",
      "displayName": "上衣"
    },
    "color": {
      "id": 1,
      "name": "红色",
      "displayName": "红色",
      "value": "#FF0000"
    },
    "season": [
      {
        "id": 1,
        "name": "春季",
        "displayName": "春季"
      },
      {
        "id": 2,
        "name": "夏季",
        "displayName": "夏季"
      }
    ],
    "isFavorite": true,
    "createdAt": "2023-01-01T12:00:00Z",
    "updatedAt": "2023-01-01T12:00:00Z"
  },
  "message": "查询成功",
  "timestamp": "2023-01-03T12:00:00Z"
}
```

#### 错误响应

```json
{
  "success": false,
  "message": "创建衣物失败",
  "error": {
    "code": "VALID_REQUIRED_FIELD",
    "details": "缺少必填字段",
    "fields": [
      {
        "field": "name",
        "message": "衣物名称不能为空"
      },
      {
        "field": "category",
        "message": "衣物分类不能为空"
      }
    ]
  },
  "timestamp": "2023-01-03T12:00:00Z"
}
```

#### 分页响应

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "name": "T恤",
        "category": "上衣",
        "createdAt": "2023-01-01T12:00:00Z"
      },
      {
        "id": 2,
        "name": "牛仔裤",
        "category": "裤子",
        "createdAt": "2023-01-02T12:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 2,
      "totalPages": 1,
      "hasNext": false,
      "hasPrev": false
    }
  },
  "message": "查询成功",
  "timestamp": "2023-01-03T12:00:00Z"
}
```

### 15.2 组件间数据传递示例

#### Props 传递

```vue
<!-- 父组件 -->
<ClothingItem
  :item-data="item"
  :config="{ showFavorite: true, showDelete: false }"
  :loading="false"
  @item-click="handleItemClick"
  @favorite-change="handleFavoriteChange"
/>

<!-- 子组件 -->
<script setup lang="ts">
interface ItemData {
  id: number;
  name: string;
  category: string;
  isFavorite: boolean;
  createdAt: string;
}

interface ConfigOptions {
  showFavorite: boolean;
  showDelete: boolean;
}

const props = defineProps<{
  itemData: ItemData;
  config: ConfigOptions;
  loading?: boolean;
}>();

const emit = defineEmits<{
  'item-click': [item: ItemData];
  'favorite-change': [item: ItemData, isFavorite: boolean];
}>();
</script>
```

## 16. 实施计划

### 16.1 阶段一：规范制定与培训

1. 完成数据传递格式标准文档
2. 组织团队培训，确保所有成员理解并掌握标准
3. 制定实施计划和时间表

### 16.2 阶段二：现有代码重构

1. 后端 API 响应格式统一
2. 前端组件间数据传递规范
3. 数据库字段命名规范
4. API 文档更新

### 16.3 阶段三：工具支持

1. 开发数据验证工具
2. 开发 API 文档自动生成工具
3. 开发代码质量检查工具
4. 开发数据格式转换工具

### 16.4 阶段四：监控与优化

1. 监控 API 响应格式
2. 监控数据传递性能
3. 收集反馈，持续优化规范
4. 定期更新文档

## 17. 总结

本数据传递格式标准旨在规范 StyleVault 项目前后端及各组件间的数据传递，确保数据交换的一致性、可读性和可维护性。通过遵循本标准，可以减少开发过程中的沟通成本，提高代码质量和可维护性，为项目的长期发展奠定基础。

本标准应根据项目的实际情况和发展需求进行定期更新和优化，确保其始终符合项目的最佳实践。